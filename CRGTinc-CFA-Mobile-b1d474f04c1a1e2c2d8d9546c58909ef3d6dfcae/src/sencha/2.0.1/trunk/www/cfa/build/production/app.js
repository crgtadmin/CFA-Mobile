/*7222dc54d8960de619f01cdc00900310599fc8cc*/Ext.define("cfa.helper.PhoneGapHelper",{singleton:true,alias:"cfa.helper.PhoneGapHelper",config:{},isOnLine:function(){return navigator.onLine},checkConnection:function(){var a=navigator.network.connection.type;var b={};b[Connection.UNKNOWN]="UNKNOWN";b[Connection.ETHERNET]="ETHERNET";b[Connection.WIFI]="WIFI";b[Connection.CELL_2G]="CELL_2G";b[Connection.CELL_3G]="CELL_3G";b[Connection.CELL_4G]="CELL_4G";b[Connection.NONE]="NONE";alert("Connection type: "+b[a]);return b[a]},saveFile:function(b,a,e,c){var d=this;window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(f){f.root.getFile(a,{create:true,exclusive:false},function(g){g.createWriter(function(h){h.onwrite=function(j){if(typeof e=="function"){Ext.callback(e,c||d)}};h.write(b)},d.failOnSaveFile)},d.failOnSaveFile)},d.failOnSaveFile)},failOnSaveFile:function(a){console.log(a.code)},fileSizeValidation:function(a){var b=this;window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(c){c.root.getFile(a,{create:false,exclusive:false},function(d){d.file(function(e){if(e.size>(1024*10000)){return false}},b.failOnSaveFile)},b.failOnSaveFile)},b.failOnSaveFile);return true},loadImportedData:function(e,d){var b="[";var c=function(f){console.log(f);d(f)};var a=function(f){var g="/";f.root.getDirectory(g,{create:true},function(j){var h=j.createReader();h.readEntries(function(k){for(var l=0;l<k.length;l++){if(k[l].isFile){var m="";if(k[l].name.toUpperCase().indexOf("CFADATA")>-1){if(k[l].name.toUpperCase().indexOf("CASE")===0){m+='{"type": "Case",'}else{m+='{"type": "Device",'}m+='"name": "'+k[l].name+'",';m+='"fullPath":"'+k[l].fullPath+'"}';b+=m+","}}}if(b[b.length-1]==","){b=b.slice(0,-1)+"]"}else{b+="]"}e(b)},c)},c)};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,a,c)},loadDownloadedDocuments:function(e,d){var b="[";var c=function(f){console.log(f);d(f)};var a=function(f){var g="/";f.root.getDirectory(g,{create:true},function(j){var h=j.createReader();h.readEntries(function(k){for(var l=0;l<k.length;l++){if(k[l].isFile){var m="";if(k[l].name.toUpperCase().indexOf("PDF")>-1){m+='{"type": "DOCUMENT",';m+='"name": "'+k[l].name+'",';m+='"fullPath":"'+k[l].fullPath+'"}';b+=m+","}}}if(b[b.length-1]==","){b=b.slice(0,-1)+"]"}else{b+="]"}e(b)},c)},c)};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,a,c)},getImagesByFormId:function(e,d,c){var b=function(f){console.log(f);c(f)};var a=function(g){var f="/images/";g.root.getDirectory(f,{create:true});f=f+e;g.root.getDirectory(f,{create:true},function(j){var h=j.createReader();h.readEntries(function(k){d(k)},b)},b)};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,a,b)},getJsonStringFromImages:function(e,f,d,b){var c=this;var a=function(g){console.log(g);if(typeof b=="function"){b(g)}};c.getImagesByFormId(e,function(l){var j=l.length;var k;var g="[";var h=function(m){if(m<j){k=l[m];k.file(function(o){var n=new FileReader();n.onloadend=function(p){g+='{"name": "'+k.name+'",';g+='"formId": "'+f+'",';g+='"data": "'+p.target.result+'"},';m++;h(m)};n.readAsText(o)},a)}else{if(g[g.length-1]==","){g=g.slice(0,-1)+"]"}else{g+="]"}if(typeof d=="function"){d(g)}}};h(0)},a)},addImageByFullPath:function(g,h,f,d){var c=function(j){console.log(j);d(j)};var e=function(j){j.createWriter(b,c)};var b=function(j){j.onwrite=function(k){f()};j.onError=function(){console.log("error write")};j.write(h)};var a=function(k){var j="/images/";k.root.getDirectory(j,{create:true});j=j+g;k.root.getDirectory(j,{create:true},function(l){var m=""+new Date().getTime()+".cfaimage";l.getFile(m,{create:true},e,c)},c)};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,a,c)},saveImagesByJsonObjs:function(d,h,c){var g=d;var f=g.length;var e=this;var b=function(j){console.log(j);if(typeof c=="function"){c(j)}};var a=function(j){if(j<f){obj=g[j];e.addImageByFullPath(obj.formId,obj.data,function(){j++;a(j)},b)}else{if(typeof h=="function"){h()}}};a(0)},getFileData:function(b,d){var c=function(e){console.log("Get file data error: "+e.code)};var a=function(e){e.root.getFile(b,{create:false},function(f){f.file(function(h){var g=new FileReader();g.onloadend=function(j){if(typeof d=="function"){d(j.target.result)}};g.readAsText(h)})},c)};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,a,c)},downloadFile:function(e,b,d){var c=function(f){console.log("Download file error: "+f)};var a=function(f){f.root.getFile(e,{create:true},function(j){var h=j.fullPath.replace(e,"");j.remove();h=h+e+".pdf";var g=new FileTransfer();g.download(b,h,function(k){if(typeof d=="function"){d()}},function(k){console.log("Download error: "+k)})},c)};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,a,c)},deleteFile:function(b){var c=function(d){console.log("Delete file error: "+d.code)};var a=function(d){d.root.getFile(b,{create:false},function(e){e.remove(function(){console.log("File deleted")},function(f){console.log("File delete error: "+f)})},c)};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,a,c)}});Ext.define("cfa.helper.ChromeHelper",{singleton:true,alias:"cfa.helper.ChromeHelper",config:{},isOnLine:function(){return true},checkConnection:function(){return""},requestFileSystem:function(c,a,d,b){window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;requestFileSystem(c,a,d,b)},saveFile:function(b,a,e,c){var d=this;d.requestFileSystem(window.PERSISTENT,0,function(f){f.root.getFile(a,{create:true,exclusive:false},function(g){g.createWriter(function(h){h.onwriteend=function(k){if(typeof e=="function"){e(g.toURL())}};if(!window.BlobBuilder&&window.WebKitBlobBuilder){window.BlobBuilder=window.WebKitBlobBuilder}var j=new window.BlobBuilder();j.append(b);h.write(j.getBlob("text/plain"))},d.failOnSaveFile)},d.failOnSaveFile)},d.failOnSaveFile)},failOnSaveFile:function(a){console.log(a.code)},fileSizeValidation:function(a){var b=this;b.requestFileSystem(window.PERSISTENT,0,function(c){c.root.getFile(a,{create:false,exclusive:false},function(d){d.file(function(e){if(e.size>(1024*10000)){return false}},b.failOnSaveFile)},b.failOnSaveFile)},b.failOnSaveFile);return true},loadImportedData:function(f,d){var e=this;var b="[";var c=function(g){console.log(g);d(g)};var a=function(g){var h="/";g.root.getDirectory(h,{create:false},function(k){var j=k.createReader();j.readEntries(function(l){for(var m=0;m<l.length;m++){if(l[m].isFile){var n="";if(l[m].name.toUpperCase().indexOf("CFADATA")>-1){if(l[m].name.toUpperCase().indexOf("CASE")===0){n+='{"type": "Case",'}else{n+='{"type": "Device",'}n+='"name": "'+l[m].name+'",';n+='"fullPath":"'+l[m].fullPath+'"}';b+=n+","}}}if(b[b.length-1]==","){b=b.slice(0,-1)+"]"}else{b+="]"}f(b)},c)},c)};e.requestFileSystem(window.PERSISTENT,0,a,c)},loadDownloadedDocuments:function(f,d){var e=this;var b="[";var c=function(g){console.log(g);d(g)};var a=function(g){var h="/";g.root.getDirectory(h,{create:false},function(k){var j=k.createReader();j.readEntries(function(l){for(var m=0;m<l.length;m++){if(l[m].isFile){var n="";if(l[m].name.toUpperCase().indexOf("PDF")>-1){n+='{"type": "DOCUMENT",';n+='"name": "'+l[m].name+'",';n+='"fullPath":"'+l[m].fullPath+'"}';b+=n+","}}}if(b[b.length-1]==","){b=b.slice(0,-1)+"]"}else{b+="]"}f(b)},c)},c)};e.requestFileSystem(window.PERSISTENT,0,a,c)},getImagesByFormId:function(f,e,c){var d=this;var b=function(g){console.log(g);c(g)};var a=function(h){var g="/images/";h.root.getDirectory(g,{create:true});g=g+f;h.root.getDirectory(g,{create:true},function(k){var j=k.createReader();j.readEntries(function(l){e(l)},b)},b)};d.requestFileSystem(window.PERSISTENT,0,a,b)},getJsonStringFromImages:function(e,f,d,b){var c=this;var a=function(g){console.log(g);if(typeof b=="function"){b(g)}};c.getImagesByFormId(e,function(l){var j=l.length;var k;var g="[";var h=function(m){if(m<j){k=l[m];k.file(function(o){var n=new FileReader();n.onloadend=function(p){g+='{"name": "'+k.name+'",';g+='"formId": "'+f+'",';g+='"data": "'+p.target.result+'"},';m++;h(m)};n.readAsText(o)},a)}else{if(g[g.length-1]==","){g=g.slice(0,-1)+"]"}else{g+="]"}if(typeof d=="function"){d(g)}}};h(0)},a)},addImageByFullPath:function(g,a,h,j){var f=this;var b=function(k){console.log(k);j(k)};var c=function(k){k.createWriter(d,b)};var d=function(k){k.onwrite=function(m){h()};k.onError=function(){console.log("error write")};if(!window.BlobBuilder&&window.WebKitBlobBuilder){window.BlobBuilder=window.WebKitBlobBuilder}var l=new window.BlobBuilder();l.append(a);k.write(l.getBlob("text/plain"))};var e=function(l){var k="/images/";l.root.getDirectory(k,{create:true});k=k+g;l.root.getDirectory(k,{create:true},function(m){var n=""+new Date().getTime()+".cfaimage";m.getFile(n,{create:true},c,b)},b)};f.requestFileSystem(window.PERSISTENT,0,e,b)},saveImagesByJsonObjs:function(d,h,c){var g=d;var f=g.length;var e=this;var b=function(j){console.log(j);if(typeof c=="function"){c(j)}};var a=function(j){if(j<f){obj=g[j];e.addImageByFullPath(obj.formId,obj.data,function(){j++;a(j)},b)}else{if(typeof h=="function"){h()}}};a(0)},getFileData:function(b,d){var c=function(e){console.log("Get file data error: "+e.code)};var a=function(e){e.root.getFile(b,{create:false},function(f){f.file(function(h){var g=new FileReader();g.onloadend=function(j){if(typeof d=="function"){d(j.target.result)}};g.readAsText(h)})},c)};window.requestFileSystem(window.PERSISTENT,0,a,c)},saveDropFile:function(b,d,f){var c=this;var e=function(g){console.log("Get file data error: "+g.code)};var a=function(g){g.root.getFile(b,{create:true},function(h){h.createWriter(function(j){j.onwriteend=function(l){if(typeof f=="function"){f(h.fullPath)}};if(!window.BlobBuilder&&window.WebKitBlobBuilder){window.BlobBuilder=window.WebKitBlobBuilder}var k=new window.BlobBuilder();k.append(d);j.write(k.getBlob("text/plain"))},e)},e)};c.requestFileSystem(window.PERSISTENT,0,a,e)},decodeBase64:function(a){return atob(a)},downloadFile:function(c,a,b){},deleteFile:function(c){var b=this;var d=function(e){console.log("Delete file error: "+e.code)};var a=function(e){e.root.getFile(c,{create:false},function(f){f.remove(function(){console.log("File deleted")},function(g){console.log("File delete error: "+g)})},d)};b.requestFileSystem(window.PERSISTENT,0,a,d)}});Ext.define("cfa.utils.HelperUtil",{singleton:true,alias:"cfa.utils.HelperUtil",config:{},getHelper:function(){return Ext.os.is.Desktop?cfa.helper.ChromeHelper:cfa.helper.PhoneGapHelper}});Ext.define("cfa.utils.FileUtils",{singleton:true,alias:"cfa.utils.FileUtils",config:{XORKey:1081989,},XOREncode:function(c){var a="";var b=this.getXORKey();for(i=0;i<c.length;++i){a+=String.fromCharCode(b^c.charCodeAt(i))}return a},XORDecode:function(c){var b="";var a=this.getXORKey();for(i=0;i<c.length;i++){b+=String.fromCharCode(a^c.charCodeAt(i))}return b},isEncryptedData:function(b){try{json=JSON.parse(b);return false}catch(a){}return true},isBase64:function(b){var a=b.replace(/[A-Za-z0-9\+\/\=]/g,"");return b.length>0&&/^\s*$/.test(a)&&(a.length/b.length<=0.05)},decodeBase64:function(e){if(this.isBase64(e)){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var c=[];e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");var a=0;while(a<e.length){var l=b.indexOf(e.charAt(a++));var k=b.indexOf(e.charAt(a++));var j=b.indexOf(e.charAt(a++));var h=b.indexOf(e.charAt(a++));var g=(l<<2)|(k>>4);var f=((k&15)<<4)|(j>>2);var d=((j&3)<<6)|h;c.push(String.fromCharCode(g));if(j!=64){c.push(String.fromCharCode(f))}if(h!=64){c.push(String.fromCharCode(d))}}return c.join("")}else{console.log("Invalid Base64")}},constructor:function(a){this.initConfig(a);return this}});Ext.define("cfa.proxy.File",{extend:"Ext.data.proxy.Client",alias:"proxy.file",alternateClassName:"cfa.data.FileProxy",config:{formId:null},constructor:function(a){this.callParent(arguments)},create:function(b,d,c){var a=b.getRecords();b.setStarted();this.setRecord(a,function(){b.setCompleted();b.setSuccessful();if(typeof d=="function"){d.call(c||this,b)}})},read:function(d,j,k){var b=[],g=this,e={},a=this.getModel(),c=d.getParams()||{},f;var h=this.getFormId();if(h){g.getImagesByFormId(h,function(l){g.applyDataToModels(l,a,function(m){g.completeRead(d,j,k,m)})},function(l){console.log(l)})}d.setSuccessful()},update:function(b,d,c){var a=b.getRecords();b.setStarted();this.setRecord(a,function(){b.setCompleted();b.setSuccessful();if(typeof d=="function"){d.call(c||this,b)}})},destroy:function(b,d,c){var a=b.getRecords();this.removeRecord(a,function(){b.setCompleted();b.setSuccessful();if(typeof d=="function"){d.call(c||this,b)}})},clear:function(){var b=this;var c=function(){console.log("remove successfully")};var a=function(d){console.log(d)};b.deleteAllImagesByFormId(formId,c,a)},getRecord:function(a){return null},setRecord:function(d,j){var g=this;var b=d.length;var f;var a;var e;var h=this.getFormId();var c=function(l){console.log(l)};var k=function(l){if(l<b){f=d[l];e=f.getData();g.addImageByFullPath(h,e.srcImage,function(){l++;k(l)},c)}else{if(typeof j=="function"){j()}}};k(0)},removeRecord:function(b,h,j){var e=0;var g=this.getFormId();var a=b.length;var f=this;var c=function(k){console.log(k)};var d=function(k){if(k<a){f.deleteImageByFullPath(g,b[k].getData().fullPath,function(){k++;d(k)},c)}else{if(typeof h=="function"){h.call(j||this)}}};d(0)},applyDataToModels:function(h,c,m){if(!h||h==undefined){h=[]}var d=[],f={},a=h.length,g=0,e,j,l=this.getFormId();var b=function(n){console.log(n);failCallBack(n)};var k=function(n){if(n<a){e=h[n];f.formId=l;f.fullPath=e.fullPath;e.file(function(p){var o=new FileReader();o.onloadend=function(q){f.srcImage=q.target.result;n++;record=new c(f,n);d.push(record);k(n)};o.readAsText(p)},b)}else{if(typeof m=="function"){m(d)}}};k(0)},getImagesByFormId:function(e,d,c){var b=function(f){console.log(f);c(f)};var a=function(g){var f="/images/";g.root.getDirectory(f,{create:true});f=f+e;g.root.getDirectory(f,{create:true},function(j){var h=j.createReader();h.readEntries(function(k){d(k)},b)},b)};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,a,b)},deleteAllImagesByFormId:function(e,d,c){var a="/images/"+e;var b=function(f){console.log(f);c(f)};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(f){f.root.getDirectory(a,{create:false,exclusive:false},function(g){g.removeRecursively(d,b)},b)},b)},deleteImageByFullPath:function(f,c,e,d){var b=function(g){console.log(g);d(g)};var a=function(h){var g="/images/";h.root.getDirectory(g,{create:false});g=g+f;h.root.getDirectory(g,{create:false},function(k){var j=k.createReader();j.readEntries(function(l){var m;for(m=0;m<l.length;m++){if(l[m].fullPath==c){l[m].remove();e();break}}},b)},b)};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,a,b)},addImageByFullPath:function(g,h,f,d){var c=function(j){console.log(j);d(j)};var e=function(j){j.createWriter(b,c)};var b=function(j){j.onwrite=function(k){f()};j.onError=function(){};j.write(h)};var a=function(k){var j="/images/";k.root.getDirectory(j,{create:true});j=j+g;k.root.getDirectory(j,{create:true},function(l){var m=""+new Date().getTime()+".cfaimage";l.getFile(m,{create:true},e,c)},c)};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,a,c)},completeRead:function(b,d,c,a){b.setCompleted();b.setResultSet(Ext.create("Ext.data.ResultSet",{records:a,total:a.length,loaded:true}));b.setRecords(a);if(typeof d=="function"){d.call(c||this,b)}}});Ext.define("cfa.proxy.ChromeFile",{extend:"Ext.data.proxy.Client",alias:"proxy.chromefile",alternateClassName:"cfa.data.ChromeFileProxy",config:{formId:null},constructor:function(a){this.callParent(arguments)},requestFileSystem:function(c,a,d,b){window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;requestFileSystem(c,a,d,b)},create:function(b,d,c){var a=b.getRecords();b.setStarted();this.setRecord(a,function(){b.setCompleted();b.setSuccessful();if(typeof d=="function"){d.call(c||this,b)}})},read:function(d,j,k){var b=[],g=this,e={},a=this.getModel(),c=d.getParams()||{},f;var h=this.getFormId();if(h){g.getImagesByFormId(h,function(l){g.applyDataToModels(l,a,function(m){g.completeRead(d,j,k,m)})},function(l){console.log(l)})}d.setSuccessful()},update:function(b,d,c){var a=b.getRecords();b.setStarted();this.setRecord(a,function(){b.setCompleted();b.setSuccessful();if(typeof d=="function"){d.call(c||this,b)}})},destroy:function(b,d,c){var a=b.getRecords();this.removeRecord(a,function(){b.setCompleted();b.setSuccessful();if(typeof d=="function"){d.call(c||this,b)}})},clear:function(){var b=this;var c=function(){console.log("remove successfully")};var a=function(d){console.log(d)};b.deleteAllImagesByFormId(formId,c,a)},getRecord:function(a){return null},setRecord:function(d,j){var g=this;var b=d.length;var f;var a;var e;var h=this.getFormId();var c=function(l){console.log(l)};var k=function(l){if(l<b){f=d[l];e=f.getData();g.addImageByFullPath(h,e.srcImage,function(){l++;k(l)},c)}else{if(typeof j=="function"){j()}}};k(0)},removeRecord:function(b,h,j){var e=0;var g=this.getFormId();var a=b.length;var f=this;var c=function(k){console.log(k)};var d=function(k){if(k<a){f.deleteImageByFullPath(g,b[k].getData().fullPath,function(){k++;d(k)},c)}else{if(typeof h=="function"){h.call(j||this)}}};d(0)},applyDataToModels:function(h,c,m){if(!h||h==undefined){h=[]}var d=[],f={},a=h.length,g=0,e,j,l=this.getFormId();var b=function(n){console.log(n);failCallBack(n)};var k=function(n){if(n<a){e=h[n];f.formId=l;f.fullPath=e.fullPath;e.file(function(p){var o=new FileReader();o.onloadend=function(q){f.srcImage=q.target.result;n++;record=new c(f,n);d.push(record);k(n)};o.readAsText(p)},b)}else{if(typeof m=="function"){m(d)}}};k(0)},getImagesByFormId:function(f,e,c){var d=this;var b=function(g){console.log(g);c(g)};var a=function(h){var g="/images/";h.root.getDirectory(g,{create:true});g=g+f;h.root.getDirectory(g,{create:true},function(k){var j=k.createReader();j.readEntries(function(l){e(l)},b)},b)};d.requestFileSystem(window.PERSISTENT,0,a,b)},deleteAllImagesByFormId:function(f,e,c){var d=this;var a="/images/"+f;var b=function(g){console.log(g);c(g)};d.requestFileSystem(window.PERSISTENT,0,function(g){g.root.getDirectory(a,{create:false,exclusive:false},function(h){h.removeRecursively(e,b)},b)},b)},deleteImageByFullPath:function(g,c,f,d){var e=this;var b=function(h){console.log(h);d(h)};var a=function(j){var h="/images/";j.root.getDirectory(h,{create:false});h=h+g;j.root.getDirectory(h,{create:false},function(l){var k=l.createReader();k.readEntries(function(m){var n;for(n=0;n<m.length;n++){if(m[n].fullPath==c){m[n].remove(Ext.emptyFn);f();break}}},b)},b)};e.requestFileSystem(window.PERSISTENT,0,a,b)},addImageByFullPath:function(g,a,h,j){var f=this;var b=function(k){console.log(k);j(k)};var c=function(k){k.createWriter(d,b)};var d=function(k){k.onwrite=function(m){h()};k.onError=function(){};if(!window.BlobBuilder&&window.WebKitBlobBuilder){window.BlobBuilder=window.WebKitBlobBuilder}var l=new window.BlobBuilder();l.append(a);k.write(l.getBlob("text/plain"))};var e=function(l){var k="/images/";l.root.getDirectory(k,{create:true});k=k+g;l.root.getDirectory(k,{create:true},function(m){var n=""+new Date().getTime()+".cfaimage";m.getFile(n,{create:true},c,b)},b)};f.requestFileSystem(window.PERSISTENT,0,e,b)},completeRead:function(b,d,c,a){b.setCompleted();b.setResultSet(Ext.create("Ext.data.ResultSet",{records:a,total:a.length,loaded:true}));b.setRecords(a);if(typeof d=="function"){d.call(c||this,b)}}});Ext.define("cfa.profile.Tablet",{extend:"Ext.app.Profile",config:{name:"tablet",namespace:"tablet",controllers:["Dashboard","cfa.controller.Master","cfa.controller.case.CaseController","cfa.controller.contact.ContactController","cfa.controller.event.EventController","cfa.controller.reference.ReferenceController","cfa.controller.search.SearchController","cfa.controller.setting.SettingController","cfa.controller.feedback.FeedbackController","cfa.controller.about.AboutController","cfa.controller.help.HelpController"],views:["Main","cfa.view.popup.InputTextAreaPopup","cfa.view.popup.DatePickerFieldPopup"]},isActive:function(){return !Ext.os.is.Phone},launch:function(){Ext.create("cfa.view.tablet.Main")}});Ext.define("cfa.profile.Phone",{extend:"Ext.app.Profile",config:{name:"phone",namespace:"phone",controllers:["Dashboard","cfa.controller.Master"],views:["Main"]},isActive:function(){return Ext.os.is.Phone},launch:function(){Ext.create("cfa.view.phone.Main")}});Ext.define("cfa.store.Base",{extend:"Ext.data.Store",config:{model:null,offlineStore:null},updateOfflineStore:function(b,a){if(b!=null){this.addListener("load",function(g,d,j,c,f){if(j){var h=g.getOfflineStore();h.getProxy().clear();for(var e=0;e<d.length;e++){h.add(d[e])}h.sync()}})}}});Ext.define("cfa.store.Events",{extend:"cfa.store.Base",storeId:"Events",config:{model:"cfa.model.Event",proxy:{type:"ajax",url:"data/Events.csv",reader:{type:"csv"}},grouper:{groupFn:function(a){return Ext.util.Format.date(a.get("start_date"),"m/d/Y")},sortProperty:"date",direction:"ASC"}}});Ext.define("cfa.store.Contacts",{extend:"cfa.store.Base",storeId:"Contacts",config:{model:"cfa.model.Contact",proxy:{type:"ajax",url:"data/Contacts.csv",reader:{type:"csv"}},sorters:"lastname",grouper:{groupFn:function(a){return a.get("lastname")[0]}}}});Ext.define("cfa.store.References",{extend:"cfa.store.Base",storeId:"References",config:{model:"cfa.model.Reference",proxy:{type:"ajax",url:"data/References.csv",reader:{type:"csv"}},sorters:"title",grouper:{groupFn:function(a){return a.get("title")[0]}}}});Ext.define("cfa.store.LSContacts",{extend:"cfa.store.Contacts",storeId:"LSContacts",config:{proxy:{type:"localstorage",id:"contact"}}});Ext.define("cfa.store.EventsLocal",{extend:"cfa.store.Events",storeId:"EventsLocal",config:{model:"cfa.model.Event",proxy:{type:"localstorage",id:"event"}}});Ext.define("cfa.store.ReferencesLocal",{extend:"cfa.store.References",storeId:"ReferencesLocal",config:{model:"cfa.model.Reference",proxy:{type:"localstorage",id:"reference"}}});Ext.define("cfa.store.SearchTemplates",{extend:"Ext.data.Store",config:{autoLoad:true,model:"cfa.model.SearchTemplate",proxy:{type:"ajax",url:"data/SearchTemplate.json",limitParam:false,pageParam:false,startParam:false,noCache:false,}}});Ext.define("cfa.store.Users",{extend:"Ext.data.Store",storeId:"User",config:{model:"cfa.model.User",proxy:{type:"localstorage",id:"user"}}});Ext.define("cfa.view.popup.InputTextAreaPopup",{extend:"Ext.Panel",alias:"widget.popupnote",config:{layout:"fit",scrollable:{direction:"vertical",directionLock:true},modal:true,top:"60%",left:"10%",rigth:"10%",height:"40%",width:"80%",hideOnMaskTap:true,items:[{xtype:"toolbar",itemId:"topbar",docked:"top",layout:{pack:"right",align:"center"},items:[{xtype:"button",text:"Done",listeners:{tap:{fn:Formpod.FormEngine.Utils.hidePopup,scope:Formpod.FormEngine.Utils}}}]},{xtype:"textareafield",clearIcon:false,maxRows:20,itemId:"inputfield"}],listeners:{hide:{fn:Formpod.FormEngine.Utils.onHidePopup,scope:Formpod.FormEngine.Utils}}}});Ext.define("cfa.view.popup.DatePickerFieldPopup",{extend:"Ext.picker.Date",config:{listeners:{change:{fn:Formpod.FormEngine.Utils.onChangeDatePickerPopup,scope:Formpod.FormEngine.Utils}},},});Ext.define("cfa.model.Dashboard",{extend:"Ext.data.Model",config:{fields:["urlId","label"]},toUrl:function(){return this.get("urlId")}});Ext.define("cfa.proxy.FormEngine",{extend:"Ext.data.proxy.Client",alias:"proxy.formengine",alternateClassName:"cfa.data.FormEngineProxy",config:{queryType:null,queryParam:null},constructor:function(a){this.callParent(arguments);if(Formpod===undefined){Ext.Logger.error("Formpod is not available")}},create:function(b,d,c){var a=b.getRecords();b.setStarted();this.setRecords(a,function(){b.setCompleted();b.setSuccessful();if(typeof d=="function"){d.call(c||this,b)}})},read:function(e,l,m){var c=[],j=this,f={},b=this.getModel(),n=b.getIdProperty(),d=e.getParams()||{},g;var a=this.getQueryType(),k=this.getQueryParam();if(a){if(a=="class"){if(k=="all"){var h=["System","Storage","Mobile","Media"];Formpod.findAllObjectsByClasses(h,[],function(o){j.applyDataToModels(o,b,function(p){j.completeRead(e,l,m,p)})})}else{Formpod.findObjectsByClass(k,function(o){j.applyDataToModels(o,b,function(p){j.completeRead(e,l,m,p)})})}}}else{if(d[n]!==undefined){g=this.getRecord(d[n]);if(g){c.push(g);e.setSuccessful()}c=this.applyDataToModels(objs,b);this.completeRead(e,l,m,c)}else{if(d.node=="cases"){Formpod.findObjectsByClass("Case Form",function(o){j.applyDataToModels(o,b,function(p){j.completeRead(e,l,m,p)})})}else{Formpod.findRelatedIdsWithType(d.node,"hasChild",function(o){Formpod.getObjects(o,function(p){j.applyDataToModels(p,b,function(q){j.completeRead(e,l,m,q)})})})}}}e.setSuccessful()},update:function(b,d,c){var a=b.getRecords();b.setStarted();this.setRecords(a,function(){b.setCompleted();b.setSuccessful();if(typeof d=="function"){d.call(c||this,b)}})},destroy:function(b,d,c){var a=b.getRecords();this.removeRecord(a,function(){b.setCompleted();b.setSuccessful();if(typeof d=="function"){d.call(c||this,b)}})},clear:function(){Formpod.deleteAllObjects()},getRecord:function(a){return null},setRecords:function(d,j){var g=this,b=d.length,f,a,c,e,h;for(e=0;e<b;e++){if(e==b-1){this.setRecord(d[e],function(){if(typeof j=="function"){j()}});return}else{this.setRecord(d[e])}}if(typeof j=="function"){j()}},setRecord:function(b,g){var f={},e=b.getData().form,c=e.engineClass;for(var a in e){var d=c.fields[a];f[a]=e[a];if(d&&d.type=="datepickerfield"){if(f[a]){f[a]=Ext.Date.format(f[a],Formpod.dateFormat)}}}Formpod.saveInstance(f,function(h){e.id=h.id;b.set("id",h.id);b.commit();if(b.get("parentId")){var j=parseInt(b.get("parentId"));if(j!=NaN){Formpod.relateObjectById(j,h.id,"hasChild")}}if(typeof g=="function"){g(b)}})},removeRecord:function(a,d,c){for(var b=0;b<a.length;b++){Formpod.deleteObjectWithId(a[b].getData().form.id);a[b].commit()}if(typeof d=="function"){d.call(c||this)}},applyDataToModels:function(g,b,l){var c=[],e={},a=g.length,f,d,j;for(f=0;f<a;f++){d=g[f];j=d.engineClass;for(var h in d){var k=j.fields[h];if(k&&k.type=="datepickerfield"){if(d[h]){d[h]=Ext.Date.parse(d[h],Formpod.dateFormat)}}}e.id=d.id;e.text=d[j.displayProperty];e.form=d;record=new b(e,d.id);if(f==a-1){this.updateLeaf(record,function(m){c.push(m);if(typeof l=="function"){l(c)}});return}else{this.updateLeaf(record,function(m){c.push(m)})}}if(typeof l=="function"){l(c)}},updateLeaf:function(a,d){var b=a.get("form").engineClass,c=Formpod.FormTypes[b.name].childForms;if(c&&c.length){a.set("leaf",false)}else{a.set("leaf",true)}if(typeof d=="function"){d(a)}},completeRead:function(b,d,c,a){b.setCompleted();b.setResultSet(Ext.create("Ext.data.ResultSet",{records:a,total:a.length,loaded:true}));b.setRecords(a);if(typeof d=="function"){d.call(c||this,b)}}});Ext.define("cfa.store.CFAStore",{override:"Ext.data.TreeStore",sync:function(c){c=c||{};var d={callback:Ext.emptyFn};c=Ext.apply(d,c);var h=this,b={},j=h.getNewRecords(),a=h.getUpdatedRecords(),f=h.getRemovedRecords(),l=false;if(j.length>0){b.create=j;l=true}if(a.length>0){b.update=a;l=true}if(f.length>0){b.destroy=f;l=true}if(l&&h.fireEvent("beforesync",this,b)!==false){var g=h.getBatchListeners(),k=g.complete,e;g.complete=function(){Ext.callback(k,g.scope,[e]);Ext.callback(c.callback,c.scope,[this,b])};e=h.getProxy().batch({operations:b,listeners:g})}return{added:j,updated:a,removed:f}},onBatchComplete:function(a){}});Ext.define("cfa.model.CaseForm",{extend:"Ext.data.Model",config:{fields:[{name:"name",type:"string"},{name:"description",type:"string"},"definition",{name:"displayProperty",type:"string"},"childForms"]}});Ext.define("cfa.store.CFACustomStore",{override:"Ext.data.Store",sync:function(c){c=c||{};var d={callback:Ext.emptyFn};c=Ext.apply(d,c);var h=this,b={},j=h.getNewRecords(),a=h.getUpdatedRecords(),f=h.getRemovedRecords(),l=false;if(j.length>0){b.create=j;l=true}if(a.length>0){b.update=a;l=true}if(f.length>0){b.destroy=f;l=true}if(l&&h.fireEvent("beforesync",this,b)!==false){var g=h.getBatchListeners(),k=g.complete,e;g.complete=function(){Ext.callback(k,g.scope,[e]);Ext.callback(c.callback,c.scope,[this,b])};e=h.getProxy().batch({operations:b,listeners:g})}return{added:j,updated:a,removed:f}},onBatchComplete:function(a){}});Ext.define("cfa.model.Reference",{extend:"Ext.data.Model",config:{identifier:"uuid",idProperty:"id",fields:[{name:"title",type:"string"},{name:"description",type:"string"},{name:"url",type:"string"},{name:"downloaded",type:"string"}]}});Ext.define("cfa.controller.Dashboard",{extend:"Ext.app.Controller",config:{refs:{main:"main",homebtn:"#home-btn"},control:{dashboards:{itemtap:"onDashboardItemTap"},homebtn:{tap:"goHome"}},currentRecord:null,stack:[]},init:function(){Ext.getStore("Dashboards").on("load",this.onStoreLoad,this)},ensureStoreLoad:function(b){var a=Ext.getStore("Dashboards");if(a.data.all.length){b.resume()}else{a.on("load",function(){b.resume()},this,{single:true})}},onDashboardItemTap:function(b,c,g,a,f,d){this.redirectTo(a)},goHome:function(){if(this.getMain().getActiveItem().getId()!="dashboard"){this.getMain().reset()}else{if(this.getMain().getActiveItem().getId()=="caseview"){this.getMain().backToDashboard()}}cfa.app.helpUrl="root"}});Ext.define("cfa.view.feedback.FeedbackView",{extend:"Ext.Panel",xtype:"feedback",config:{id:"feedbackview",modal:true,centered:true,hideOnMaskTap:true,height:"80%",width:"80%",title:"Feedback",layout:"fit",items:[{xtype:"formpanel",items:[{xtype:"fieldset",title:"Please enter your feedback below:",defaults:{required:true},items:[{xtype:"textareafield",id:"feedbacktext",maxRows:12}]},{xtype:"panel",height:40,items:[{xtype:"button",centered:true,id:"sendfeedbackbtn",width:200,text:"Send"}]}]}]}});Ext.define("cfa.view.case.CaseView",{extend:"Ext.Container",xtype:"case",config:{id:"caseview",title:"Case Data Management",layout:"hbox",items:[{xtype:"panel",layout:"fit",flex:1,items:[{xtype:"nestedlist",title:"Cases",iconCls:"star",id:"caseslist",store:"Cases",toolbar:{items:[{xtype:"button",iconCls:"refresh",iconMask:true,align:"right",action:"refreshCaseData",ui:"action"},{xtype:"button",iconCls:"add",iconMask:true,align:"right",action:"addCaseData",ui:"action"}]}}]},{xtype:"panel",flex:2,layout:"fit",items:[{xtype:"panel",layout:"vbox",items:[{xtype:"formpanel",baseCls:"panel-shadow",cls:["infoPanel"],id:"casecontextpanel",layout:"fit",height:80,flex:1,items:[{xtype:"label",id:"casecontextlabel"}]},{xtype:"panel",baseCls:"panel-shadow",cls:["infoPanel"],layout:"fit",flex:2,hidden:true,id:"casecontentpanel",items:[{xtype:"panel",layout:"vbox",id:"caseformpanel"}]},{xtype:"toolbar",id:"casetoolbar",layout:{align:"center",pack:"right"},docked:"bottom",hidden:true,items:[{xtype:"button",action:"deletecasedata",text:"Delete"},{xtype:"button",action:"exportcasedata",text:"Export"},{xtype:"button",action:"attachcasedata",text:"Attach"},{xtype:"button",action:"deleteattachmentdata",text:"Delete Photo"},{xtype:"button",action:"clearattachmentdata",text:"Clear Photos"},{xtype:"spacer"},{xtype:"button",action:"savecasedata",text:"Save",ui:"confirm"},{xtype:"button",action:"cancelcasedata",text:"Cancel",ui:"decline"}]}]}]}]},initialize:function(){this.callParent(arguments);cfa.app.helpUrl="CaseHelp"}});var store=Ext.getStore("Contacts");Ext.define("cfa.view.search.SearchView",{extend:"Ext.navigation.View",xtype:"searchview",config:{title:"Search",navigationBar:{items:[{xtype:"searchfield",id:"searchinputfield",align:"right",hidden:true,clearIcon:false}]},items:[{xtype:"list",title:"Search Templates",id:"searchtemplatelist",itemTpl:'</pre><div>{text}</div><div><font size="-1">{description}</font></div><pre>',store:"SearchTemplates"}]},pop:function(){this.callParent(arguments);Ext.getCmp("searchinputfield").setValue("")},initialize:function(){this.callParent(arguments);cfa.app.helpUrl="SearchHelp"}});Ext.define("cfa.model.SearchTemplate",{extend:"Ext.data.Model",config:{indentifier:"uuid",fields:[{name:"text",type:"string"},{name:"description",type:"string"},{name:"queryType",type:"string"},{name:"queryParam",type:"string"}]}});Ext.define("cfa.view.search.DeviceEditor",{extend:"Ext.Panel",config:{id:"deviceeditor",layout:"fit",items:[{xtype:"panel",itemId:"editorpanel",layout:"fit"},{xtype:"toolbar",docked:"bottom",layout:{align:"center",pack:"right"},items:[{xtype:"button",action:"savedevicedata",text:"Save",ui:"confirm"},{xtype:"button",action:"canceldevicedata",text:"Cancel",ui:"decline"}]}]}});Ext.define("cfa.view.search.SearchResultList",{extend:"Ext.Panel",alias:"widget.searchsesultlist",config:{title:"Search Results",layout:"fit",items:[{xtype:"list",itemId:"resultlist",mode:"MULTI",onItemDisclosure:true},{xtype:"toolbar",itemId:"actionbar",docked:"bottom",layout:{align:"center",pack:"right"},items:[{xtype:"button",text:"Export",action:"exportdevicedata"},{xtype:"button",text:"Delete",action:"deletedevicedata"},{xtype:"button",text:"Reset",action:"resetselection"}]}]}});Ext.define("cfa.view.search.NotesReportView",{extend:"Ext.Panel",config:{title:"Notes",scrollable:{direction:"vertical",directionLock:true},items:[]}});Ext.define("cfa.view.setting.SettingView",{extend:"Ext.Panel",xtype:"setting",config:{title:"Settings",layout:"fit",items:[{xtype:"formpanel",itemId:"settingformpanel",items:[{xtype:"fieldset",title:"General Information",defaults:{labelWidth:"20%"},items:[{xtype:"textfield",itemId:"firstname",name:"firstname",label:"First Name",autoCapitalize:true},{xtype:"textfield",itemId:"lastname",name:"lastname",label:"Last Name",autoCapitalize:true}]},{xtype:"panel",items:[{xtype:"button",action:"saveuserdata",width:200,text:"Save"}]},{xtype:"fieldset",itemId:"aboutfieldset",title:"About",defaults:{labelWidth:"20%"},items:[{xtype:"textfield",itemId:"versiontextfield",label:"Version",value:"",readOnly:true}]},{xtype:"panel",layout:"hbox",items:[{xtype:"button",action:"resetdatabtn",width:200,text:"Reset Data"},{xtype:"button",action:"importdatabtn",width:200,margin:"0 0 0 20",text:"Import Data"},{xtype:"button",action:"managedocument",width:200,margin:"0 0 0 20",text:"Manage Documents"}]}]}]},initialize:function(){var c=this.getComponent("settingformpanel"),b=c.getComponent("aboutfieldset"),a=b.getComponent("versiontextfield");a.setValue(cfa.app.application.buildVersion.version);cfa.app.helpUrl="SettingHelp"}});Ext.define("cfa.model.Import",{extend:"Ext.data.Model",config:{fields:[{name:"type",type:"string"},{name:"name",type:"string"},{name:"fullPath",type:"string"}]}});Ext.define("cfa.model.User",{extend:"Ext.data.Model",config:{identifier:"uuid",fields:[{name:"firstname",type:"string"},{name:"lastname",type:"string"}]}});Ext.define("cfa.view.setting.ImportDataView",{extend:"Ext.Panel",config:{modal:true,layout:"fit",hideOnMaskTap:true,hidden:true,centered:true,width:"40%",height:" 60%",fullScreen:true,items:[{xtype:"navigationview",itemId:"container",},{xtype:"panel",id:"dragpanel",docked:"bottom",items:[{xtype:"textareafield",hidden:true,id:"dragfilefield",docked:"bottom",margin:5,placeHolder:"Drag import file in here"}]},{xtype:"toolbar",itemId:"actionbar",docked:"bottom",items:[{xtype:"button",text:"Delete",action:"deletefile"}]}]}});Ext.define("cfa.view.about.AboutView",{extend:"Ext.Panel",config:{modal:true,centered:true,hideOnMaskTap:true,height:200,width:600,title:"About",layout:"fit",items:[{centered:true,itemId:"versionpanel",html:['<p align="center">CFA Mobile app</p>'].join("")}]},initialize:function(){var b=this.getComponent("versionpanel"),a=b.getHtml();a+="<p>Version "+cfa.app.application.buildVersion.version+"</p>";b.setHtml(a)}});Ext.define("cfa.view.help.HelpView",{extend:"Ext.Panel",config:{modal:true,centered:true,hideOnMaskTap:true,height:200,width:600,title:"Help",layout:"fit",items:[{centered:true,html:['<p align="center">Coming Soon</p>'].join("")}]}});Ext.define("cfa.view.help.HTMLPanel",{extend:"Ext.Panel",alias:"widget.htmlpanel",requires:["Ext.Ajax"],config:{url:null,modal:true,centered:true,hideOnMaskTap:true,height:"60%",width:"60%",styleHtmlContent:true,scrollable:{direction:"vertical"}},updateUrl:function(c,b){var a=this;Ext.Ajax.request({url:this.getUrl(),method:"GET",disableCaching:false,success:function(d,e){a.setHtml(d.responseText)},failure:function(d,e){if(d.status==0&&d.responseText!=""){a.setHtml(d.responseText)}else{console.log("Load HTML View failed");a.setHtml("<font color='white'> Offline Mode</font>")}}})}});Ext.define("cfa.view.Dashboards",{extend:"Ext.dataview.DataView",xtype:"dashboards",config:{title:"CFA Mobile",id:"dashboard",scrollable:false,refs:{main:"main"},baseCls:"dashboards-list",itemTpl:['<div class="image" style="background-image:url(resources/icons/{urlId}.png)"></div>','<div class="name">{label}</div>'].join("")},applyData:function(a){this.setRecords(a);return Ext.pluck(a||[],"data")}});Ext.define("cfa.model.Image",{extend:"Ext.data.Model",config:{identifier:"uuid",fields:[{name:"formId",type:"string"},{name:"srcImage",type:"string"},{name:"fullPath",type:"string"}]}});Ext.define("cfa.view.contact.ContactsList",{extend:"Ext.dataview.List",alias:"widget.contact_list",config:{loadingText:"Loading contacts...",itemTpl:"</pre>	<div>{firstname} {lastname}</div><pre>",grouped:true},});Ext.define("cfa.model.Contact",{extend:"Ext.data.Model",config:{identifier:"uuid",fields:[{name:"firstname",type:"string"},{name:"lastname",type:"string"},{name:"email",type:"email"},{name:"office_phone",type:"string"},{name:"cell",type:"string"},{name:"SAC",type:"string"},{name:"RAC",type:"string"},{name:"street1",type:"string"},{name:"sreet2",type:"string"},{name:"city",type:"string"},{name:"state",type:"string"},{name:"zip",type:"int"}]}});Ext.define("cfa.view.contact.ContactDetail",{extend:"Ext.form.Panel",alias:"widget.contact_detail",requires:["Ext.form.FieldSet"],config:{itemid:"contactdetailpanel",items:[{xtype:"fieldset",items:[{xtype:"textfield",name:"firstname",label:"First Name",readOnly:true},{xtype:"textfield",name:"lastname",label:"Last Name",readOnly:true},{xtype:"urlfield",id:"email",name:"email",label:"Email",readOnly:true,listeners:{element:"element",touchstart:function(){this.fireEvent("openmailcomposercommand",this)}}},{xtype:"textfield",name:"office_phone",label:"Office Phone",readOnly:true},{xtype:"textfield",name:"cell",label:"Cell",readOnly:true}]},{xtype:"fieldset",items:[{xtype:"textfield",name:"SAC",label:"SAC",readOnly:true},{xtype:"textfield",name:"RAC",label:"RAC",readOnly:true},{xtype:"textfield",name:"street1",label:"Street 1",readOnly:true},{xtype:"textfield",name:"street2",label:"Street 2",readOnly:true},{xtype:"textfield",name:"city",label:"City",readOnly:true},{xtype:"textfield",name:"state",label:"State",readOnly:true},{xtype:"textfield",name:"zip",label:"Zip",readOnly:true}]}]}});Ext.define("cfa.reader.Csv",{extend:"Ext.data.reader.Json",alternateClassName:"cfa.reader.CsvReader",alias:"reader.csv",getResponseData:function(a){csvRows=a.responseText.split(/[\r\n]/g);for(var c=0;c<csvRows.length;c++){if(csvRows[c].replace(/^[\s]*|[\s]*$/g,"")==""){csvRows.splice(c,1);c--}}if(csvRows.length<2){console.log("CSV file is empty");return[]}else{objArr=[];for(var c=0;c<csvRows.length;c++){csvRows[c]=this.parseCSVLine(csvRows[c])}for(var c=1;c<csvRows.length;c++){if(csvRows[c].length>0){objArr.push({})}for(var b=0;b<csvRows[c].length;b++){objArr[c-1][csvRows[0][b]]=csvRows[c][b]}}return objArr}},parseCSVLine:function(a){a=a.split(",");for(var e=0;e<a.length;e++){var d=a[e].replace(/^[\s]*|[\s]*$/g,"");var b="";if(d.charAt(0)=='"'||d.charAt(0)=="'"){b=d.charAt(0)}if(b!=""&&d.charAt(d.length-1)==b){b=""}if(b!=""){var c=e+1;if(c<a.length){d=a[c].replace(/^[\s]*|[\s]*$/g,"")}while(c<a.length&&d.charAt(d.length-1)!=b){a[e]+=","+a[c];a.splice(c,1);d=a[c].replace(/[\s]*$/g,"")}if(c<a.length){a[e]+=","+a[c];a.splice(c,1)}}}for(var e=0;e<a.length;e++){a[e]=a[e].replace(/^[\s]*|[\s]*$/g,"");if(a[e].charAt(0)=='"'){a[e]=a[e].replace(/^"|"$/g,"")}else{if(a[e].charAt(0)=="'"){a[e]=a[e].replace(/^'|'$/g,"")}}}return a}});Ext.define("cfa.view.event.EventsList",{extend:"Ext.dataview.List",alias:"widget.events_list",config:{loadingText:"Loading events...",itemTpl:'</pre>	<div class="list-item-title">{event_name}</div><pre>',grouped:true}});Ext.define("cfa.model.Event",{extend:"Ext.data.Model",config:{identifier:"uuid",fields:[{name:"start_date",type:"date"},{name:"end_date",type:"date"},{name:"event_name",type:"string"},{name:"time",type:"string"},{name:"location",type:"string"},{name:"event_description",type:"string"}]}});Ext.define("cfa.view.event.EventDetail",{extend:"Ext.form.Panel",alias:"widget.event_detail",requires:["Ext.form.FieldSet"],config:{items:[{xtype:"fieldset",items:[{xtype:"textfield",name:"event_name",label:"Title",readOnly:true},{xtype:"datepickerfield",name:"start_date",label:"Start Date",readOnly:true},{xtype:"datepickerfield",name:"end_date",label:"End Date",readOnly:true},{xtype:"textfield",name:"time",label:"Time",readOnly:true},{xtype:"textfield",name:"location",label:"Location",readOnly:true},{xtype:"textareafield",name:"event_description",label:"Description",maxRows:20,readOnly:true}]}]}});Ext.define("cfa.view.reference.ReferencesList",{extend:"Ext.dataview.List",alias:"widget.references_list",config:{loadingText:"Loading reference...",itemTpl:'</pre><div> <div style="overflow:hidden;"><div style="float:left">{title}</div><div style="float:right"><font size="-1">{downloaded}</font></div></div></div> <div><font size="-1">{description}</font></div> </div><pre>',grouped:true}});Ext.define("Deft.log.Logger",{alternateClassName:["Deft.Logger"],singleton:true,log:function(b,a){},error:function(a){this.log(a,"error")},info:function(a){this.log(a,"info")},verbose:function(a){this.log(a,"verbose")},warn:function(a){this.log(a,"warn")},deprecate:function(a){this.log(a,"deprecate")}},function(){var a;if(Ext.isFunction((a=Ext.Logger)!=null?a.log:void 0)){this.log=Ext.bind(Ext.Logger.log,Ext.Logger)}else{if(Ext.isFunction(Ext.log)){this.log=function(c,b){if(b==null){b="info"}if(b==="deprecate"){b="warn"}Ext.log({msg:c,level:b})}}}});Ext.define("Deft.ioc.DependencyProvider",{requires:["Deft.log.Logger"],config:{identifier:null,className:null,parameters:null,fn:null,value:null,singleton:true,eager:false},constructor:function(b){var a;this.initConfig(b);if((b.value!=null)&&b.value.constructor===Object){this.setValue(b.value)}if(this.getEager()){if(this.getValue()!=null){Ext.Error.raise({msg:"Error while configuring '"+(this.getIdentifier())+"': a 'value' cannot be created eagerly."})}if(!this.getSingleton()){Ext.Error.raise({msg:"Error while configuring '"+(this.getIdentifier())+"': only singletons can be created eagerly."})}}if(this.getClassName()!=null){a=Ext.ClassManager.get(this.getClassName());if(!(a!=null)){Deft.Logger.warn("Synchronously loading '"+(this.getClassName())+"'; consider adding Ext.require('"+(this.getClassName())+"') above Ext.onReady.");Ext.syncRequire(this.getClassName());a=Ext.ClassManager.get(this.getClassName())}if(!(a!=null)){Ext.Error.raise({msg:"Error while configuring rule for '"+(this.getIdentifier())+"': unrecognized class name or alias: '"+(this.getClassName())+"'"})}}if(!this.getSingleton()){if(this.getClassName()!=null){if(Ext.ClassManager.get(this.getClassName()).singleton){Ext.Error.raise({msg:"Error while configuring rule for '"+(this.getIdentifier())+"': singleton classes cannot be configured for injection as a prototype. Consider removing 'singleton: true' from the class definition."})}}if(this.getValue()!=null){Ext.Error.raise({msg:"Error while configuring '"+(this.getIdentifier())+"': a 'value' can only be configured as a singleton."})}}else{if((this.getClassName()!=null)&&(this.getParameters()!=null)){if(Ext.ClassManager.get(this.getClassName()).singleton){Ext.Error.raise({msg:"Error while configuring rule for '"+(this.getIdentifier())+"': parameters cannot be applied to singleton classes. Consider removing 'singleton: true' from the class definition."})}}}return this},resolve:function(c){var a,b;Deft.Logger.log("Resolving '"+(this.getIdentifier())+"'.");if(this.getValue()!=null){return this.getValue()}a=null;if(this.getFn()!=null){Deft.Logger.log("Executing factory function.");a=this.getFn().call(null,c)}else{if(this.getClassName()!=null){if(Ext.ClassManager.get(this.getClassName()).singleton){Deft.Logger.log("Using existing singleton instance of '"+(this.getClassName())+"'.");a=Ext.ClassManager.get(this.getClassName())}else{Deft.Logger.log("Creating instance of '"+(this.getClassName())+"'.");b=this.getParameters()!=null?[this.getClassName()].concat(this.getParameters()):[this.getClassName()];a=Ext.create.apply(this,b)}}else{Ext.Error.raise({msg:"Error while configuring rule for '"+(this.getIdentifier())+"': no 'value', 'fn', or 'className' was specified."})}}if(this.getSingleton()){this.setValue(a)}return a}});Ext.define("cfa.store.Dashboards",{extend:"Ext.data.TreeStore",requires:["cfa.model.Dashboard"],config:{model:"cfa.model.Dashboard",autoLoad:true,root:{expanded:true},data:[{label:"Cases",urlId:"cases"},{label:"Contacts",urlId:"contacts"},{label:"Events",urlId:"events"},{label:"Reference",urlId:"reference"},{label:"Search",urlId:"search"},{label:"Settings",urlId:"settings"}]}});Ext.define("cfa.store.CaseForms",{extend:"Ext.data.Store",requires:["cfa.model.CaseForm"],config:{autoLoad:true,model:"cfa.model.CaseForm"}});Ext.define("cfa.store.ReferencesDownloaded",{extend:"Ext.data.Store",storeId:"references_downloaded",requires:["cfa.model.Reference","cfa.store.CFACustomStore"],config:{model:"cfa.model.Reference",proxy:{type:"localstorage",id:"references_downloaded"}}});Ext.define("cfa.controller.tablet.Dashboard",{extend:"cfa.controller.Dashboard",config:{},init:function(){this.callParent()}});Ext.define("cfa.controller.Master",{extend:"Ext.app.Controller",requires:["cfa.view.feedback.FeedbackView"],config:{refs:{main:"main",aboutbtn:"#about-btn",basicbtn:"#basic-btn",fedbtn:"#fed-btn"},control:{aboutbtn:{tap:"goToAbout"},basicbtn:{tap:"goToBasic"},fedbtn:{tap:"goToFed"}}},goToAbout:function(){this.redirectTo("about")},goToBasic:function(){if(cfa.app.helpUrl=="root"){this.redirectTo("help")}else{this.redirectTo("help/"+cfa.app.helpUrl)}},goToFed:function(){this.redirectTo("feedback")}});Ext.define("cfa.controller.search.SearchController",{extend:"Ext.app.Controller",requires:["cfa.view.search.SearchView","cfa.model.SearchTemplate","cfa.view.search.DeviceEditor","cfa.view.search.SearchResultList","cfa.view.search.NotesReportView"],config:{routes:{search:"showReportPage"},refs:{main:"main",searchView:"searchview",searchTemplateList:'list[id = "searchtemplatelist"]',resultList:'list[id = "resultlist"]',searchInputField:'searchfield[id = "searchinputfield"]',onSaveDeviceButtonClick:"button[action=savedevicedata]",onCancelDeviceButtonClick:"button[action=canceldevicedata]",onExportDeviceDataClick:"button[action=exportdevicedata]",onResetSelectionClick:"button[action=resetselection]",onDeleleDeviceClick:"button[action=deletedevicedata]"},control:{main:{beforepopcommand:"onMainBack",},searchTemplateList:{activate:"activateSearchTemplateList",select:"searchByTemplate"},searchInputField:{keyup:"setFilterByKey"},searchView:{pop:"onPop",back:"onBack"},onSaveDeviceButtonClick:{tap:"saveDeviceData"},onCancelDeviceButtonClick:{tap:"cancelDeviceData"},onExportDeviceDataClick:{tap:"exportDeviceData"},onResetSelectionClick:{tap:"resetSelection"},onDeleleDeviceClick:{tap:"deleteDeviceData"}},currentRecord:null,currentView:"",resultListView:null,currentList:"",currentActionSheet:null},showReportPage:function(){var a=Ext.create("cfa.view.search.SearchView");this.getMain().push(a);this.setCurrentView("SearchTemplate")},launch:function(){Ext.getStore("SearchTemplates").load()},activateSearchTemplateList:function(){this.getSearchTemplateList().deselectAll();this.getSearchTemplateList().getStore().clearFilter(false)},searchByTemplate:function(e,a,c){var d={disclose:{fn:this.onResultsListItemDisclosure,scope:this}};var b=Ext.create("cfa.store.SearchCases",{queryType:a.getData().queryType,queryParam:a.getData().queryParam}).load();this.setResultListView(Ext.create("cfa.view.search.SearchResultList"));this.getResultListView().getComponent("resultlist").setStore(b);this.getResultListView().getComponent("resultlist").setListeners(d);this.setCurrentView("ResultList");if(a.getData().queryParam!="Case Form"){this.setCurrentList("DeviceList")}else{this.setCurrentList("CaseList");this.getResultListView().getComponent("actionbar").hide();this.getResultListView().getComponent("resultlist").setMode("SINGLE")}this.getSearchInputField().show();this.getSearchInputField().setValue("");this.getSearchView().push(this.getResultListView())},setFilterByKey:function(d,c,b){var a;if(this.getResultListView()){a=this.getResultListView().getComponent("resultlist").getStore()}a.clearFilter(false);if(d.getValue()&&d.getValue()!=""){if(this.getResultListView()){a.filterBy(function(f){var g=d.getValue().toLowerCase();var h=false;var e=f.getData().form;for(key in e){if(typeof e[key]=="string"){if(e[key].trim()!="N/A"){if(e[key].toLowerCase().indexOf(g)>-1){h=true}}}else{if(typeof e[key]=="object"){if(key!="engineClass"&&key!="prototype"){if(e[key] instanceof Date){if(e[key].toDateString().indexOf(g)>-1){h=true}}}}}}if(h){return f}})}}},onPop:function(a,b,c){if(b.getId()=="deviceeditor"){b.getComponent("editorpanel").removeAll(false);if(this.getCurrentView()=="ResultList"){this.getResultListView().getComponent("resultlist").deselectAll()}}else{this.setResultListView(null)}b.destroy()},onMainBack:function(){if(this.getCurrentActionSheet()){this.getCurrentActionSheet().hide()}},saveDeviceData:function(){if(this.formChanged()){var b=this.getCurrentRecord(),c,g=this;if(b){var a;if(this.getCurrentView()=="DeviceEditor"){a=this.getSearchView().getComponent("deviceeditor")}else{if(this.getCurrentView()=="ResultList"){a=this.getResultListView()}}if(a){a.setMasked({xtype:"loadmask",message:"Saving..."})}var h=b.validate();if(!h.isValid()){var f="";Ext.each(h.items,function(k,j){f+=k.getMessage()+"<br>"});Ext.Msg.alert("Save Data",f,Ext.emptyFn);return false}c=this.getResultListView().getComponent("resultlist").getStore();var e=b.get("form"),d=e.engineClass;e=d.getFormObject();b.beginEdit();b.set("form",e);b.set("text",e[Formpod.FormTypes[d.name].displayProperty]);b.endEdit();c.sync({callback:function(){if(a){a.unmask()}d.scrollFormToTop();Ext.Msg.alert("Save Data","Data saved successfully")}})}}},cancelDeviceData:function(){var a=this.getCurrentRecord();if(a){var c=a.get("form");data=c;var b=c.engineClass;b.resetForm();b.loadForm(data);b.scrollFormToTop()}},onBack:function(){if(this.getCurrentView()=="DeviceEditor"){if(this.formChanged()){Ext.Msg.confirm("Data Changed","Do you want to save changes information?",this.confirmFormChanged,this)}}if(this.getCurrentView()=="DeviceEditor"||this.getCurrentView()=="NotesReport"){this.setCurrentView("ResultList");this.getResultListView().getComponent("resultlist").getStore().clearFilter(false);this.getSearchInputField().show()}else{if(this.getCurrentView()=="ResultList"){this.setCurrentView("SearchTemplate");this.getSearchInputField().hide()}}if(this.getCurrentActionSheet()){this.getCurrentActionSheet().hide()}},formChanged:function(){var a=this.getCurrentRecord();var e=false;if(a){var c=a.getData().form;var b=c.engineClass,d=b.getFormObject();for(key in d){if(d[key]==""&&c[key]==null){continue}if(d[key]==null&&c[key]==""){continue}if(typeof d[key]=="object"){if(d[key] instanceof Date){if(typeof c[key]!="undefined"&&c[key]!=null){if(Ext.Date.format(d[key],Formpod.dateFormat)!=Ext.Date.format(c[key],Formpod.dateFormat)){e=true}}else{e=true}}}else{if(typeof d[key]=="string"){if(d[key]!=c[key]){e=true;break}}}}}return e},confirmFormChanged:function(a){if(a=="yes"){if(!this.saveDeviceData()){return}}},resetSelection:function(){this.getResultListView().getComponent("resultlist").deselectAll()},exportDeviceData:function(){if(Ext.os.is.Desktop){Ext.Msg.alert("Export Data","Currently support only for iPad.")}else{var c=this;var d;var a="Device-"+Ext.util.Format.date(new Date(),"Ymd");d=this.getResultListView().getComponent("resultlist").getSelection();if(!(d&&d.length>0)){Ext.Msg.alert("Export Data","Please select item(s) you want to export first.");return}var b=Ext.create("Ext.ActionSheet",{modal:false,left:"60%",right:"20%",bottom:"6%",items:[{text:"Via email",handler:function(){var h="[",e,g=0,f="";for(e=0;e<d.length;e++){f=f+"-"+d[e].getData().form.id;Formpod.exportData(d[e].getData().form,function(j){h=h+j+",";g++;if(g==(d.length)){a=a+"-"+f+".cfadata";if(h[h.length-1]==","){h=h.slice(0,-1)}h=h+"]";cfa.helper.PhoneGapHelper.saveFile(h,a,function(){window.plugins.emailComposer.showEmailComposer("CFA Data",null,a,null,null,null,null)})}})}b.hide()}},{text:"To iTunes",handler:function(){var h="[",e,g=0,f="";for(e=0;e<d.length;e++){f=f+"-"+d[e].getData().form.id;Formpod.exportData(d[e].getData().form,function(j){h=h.concat(j+",");g++;if(g==(d.length)){a=a+"-"+f+".cfadata";if(h[h.length-1]==","){h=h.slice(0,-1)}h=h+"]";cfa.helper.PhoneGapHelper.saveFile(h,a,function(){Ext.Msg.alert("Export Data","Data has been exported successfully.")})}})}b.hide()}},{text:"Cancel",ui:"confirm",handler:function(){b.hide()}}]});Ext.Viewport.add(b);b.show();this.setCurrentActionSheet(b)}},deleteDeviceData:function(){var a;a=this.getResultListView().getComponent("resultlist").getSelection();if(a&&a.length>0){Ext.Msg.confirm("Delete Data","Do you want to delete this data?",this.confirmDeleteData,this)}else{Ext.Msg.alert("Export Data","Please select item(s) you want to delete first.")}},confirmDeleteData:function(c){var d,a;if(c=="yes"){d=this.getResultListView().getComponent("resultlist").getSelection();a=this.getResultListView().getComponent("resultlist").getStore();for(var b=0;b<d.length;b++){a.remove(d[b]);a.sync()}}},showNotesForCase:function(d){var b=this;this.setCurrentView("NotesView");var c=Ext.create("cfa.view.search.NotesReportView");var a=function(h,j){for(var g=0;g<h.length;g++){var e=Ext.create("Ext.form.FieldSet",{title:h[g].data.name.replace(/"/g,""),margin:"0 0 0 "+j*25,padding:10});var f=h[g].data.values;e=b.createNotePanel(f,e);c.add(e);if(h[g].childs){j++;a(h[g].childs,j)}}};a(d,1);b.getSearchView().push(c)},createNotePanel:function(a,b){var c=b;for(key in a){var d={xtype:"fieldset",title:key.replace(/"/g,""),items:[{xtype:"textareafield",readOnly:true,value:a[key]}]};c.add(d)}return c},onResultsListItemDisclosure:function(g,d,f,e,a,h){var j=this;this.setCurrentRecord(d);if(this.getCurrentList()=="DeviceList"){var l=Ext.create("cfa.view.search.DeviceEditor");var c=d.get("form");data=c;var k=c.engineClass;k.resetForm();k.loadForm(data);var b=k.getForm();l.getComponent("editorpanel").add(b);this.getSearchView().push(l);this.setCurrentView("DeviceEditor");this.getSearchInputField().hide()}else{j.getNotesForCase(this.getCurrentRecord().getData().form,function(m){var n=[];n.push(m);j.showNotesForCase(n)});this.setCurrentView("NotesReport");this.getSearchInputField().hide()}},getFormNotes:function(b,d){var a={};var c={};for(key in b){if(typeof b[key]!="object"){if(key.indexOf("Notes")>-1){a['"'+this.getSectionNameForKey(key)+'"']=b[key]}}}c.data={};c.data["values"]=a;if(b.engineClass.name=="Case Form"){c.data["name"]=b.CaseTitle}else{if(b.engineClass.name=="System"||b.engineClass.name=="Storage"||b.engineClass.name=="Media"||b.engineClass.name=="Mobile"){c.data["name"]=b.DevName}else{if(b.engineClass.name=="Photo/Attachment"){c.data["name"]=b.AlbumName}else{if(b.engineClass.name=="Assistance Request Form"){c.data["name"]=b.ProsecutorName}else{if(b.engineClass.name=="Border Response Form"){c.data["name"]=b.SubjectName}}}}}if(typeof d==="function"){d(c)}},getSectionNameForKey:function(a){if(a=="GeneralNotes"){return"General"}else{if(a=="OnsiteNotes"){return"Onsite"}else{if(a=="CompletionNotes"){return"Completion"}else{if(a=="SystemNotes"){return"System"}else{if(a=="SeizureNotes"){return"Seizure"}else{if(a=="SystemInformationNotes"){return"System Information"}else{if(a=="StorageNotes"){return"Storage"}else{if(a=="MediaNotes"){return"Media"}else{if(a=="MobileNotes"){return"Mobile"}else{if(a=="Notes"){return"Notes"}}}}}}}}}}},getNotesForCase:function(b,c){var a=this;this.getFormNotes(b,function(d){Formpod.findRelatedObjectsWithType(b,"hasChild",true,function(j){var k=0,f;var h=j.length;var g=[];if(h>0){var e=function(l){if(l==h&&typeof c==="function"){d.childs=g;c(d)}else{a.getNotesForCase(j[l],function(m){g.push(m);l++;e(l)})}};e(0)}if(k==h&&typeof c==="function"){c(d)}})})}});Ext.define("cfa.controller.setting.SettingController",{extend:"Ext.app.Controller",requires:["cfa.view.setting.SettingView","cfa.model.Import","cfa.model.User","cfa.view.setting.ImportDataView"],config:{routes:{settings:"showSettingPage"},refs:{main:"main",resetDataButton:"button[action = resetdatabtn]",importDataButton:"button[action = importdatabtn]",saveUserDataButton:"button[action = saveuserdata]",manageDocumentButton:"button[action = managedocument]",deleteButton:"button[action = deletefile]"},control:{resetDataButton:{tap:"resetData"},importDataButton:{tap:"importData"},saveUserDataButton:{tap:"saveUserData"},deleteImportButton:{tap:"deleteImportItems"},manageDocumentButton:{tap:"manageDocument"},deleteButton:{tap:"deleteFile"}},importListView:undefined,importStore:undefined,casesStore:undefined,casesList:undefined,documentStore:undefined,documentStoreView:undefined,settingView:null,currentImportFile:"",helper:cfa.utils.HelperUtil.getHelper(),fileUtils:cfa.utils.FileUtils,isBindDropEvent:false,currentListView:undefined},showSettingPage:function(){this.setSettingView(Ext.create("cfa.view.setting.SettingView"));if(Ext.os.is.Desktop){this.getManageDocumentButton().hide()}else{this.getManageDocumentButton().show()}this.getMain().push(this.getSettingView());Ext.getStore("Users").load({callback:function(a,c,b){this.getSettingView().getComponent("settingformpanel").setRecord(a[0])},scope:this});window.webkitStorageInfo.requestQuota(window.PERSISTENT,1024*1024*50,function(a){},function(a){Ext.Msg.alert("Error","Error allocating quota")})},resetData:function(){Ext.Msg.confirm("Reset Data","Do you want to reset data?",this.confirmResetData,this)},onImportListItemDisclosure:function(g,d,f,e,b,h){var j=this,c=function(l){console.log("Error: "+l.code)};if(d.getData().type.toUpperCase()=="CASE"){j.getHelper().getFileData(d.getData().fullPath,function(l){j.getSettingView().setMasked({xtype:"loadmask",message:"Importing..."});if(j.getFileUtils().isEncryptedData(l)){l=j.getFileUtils().XORDecode(l)}Formpod.importData(l,function(){Ext.Msg.alert("Import Data","Data imported successfully",Ext.emptyFn,j);j.getSettingView().unmask()})});j.getImportListView().hide()}else{if(j.getCasesStore()==undefined){var k=Ext.create("cfa.store.SearchCases",{queryType:"class",queryParam:"Case Form"}).load();j.setCasesStore(k);var a={xtype:"panel",layout:"fit",items:[{xtype:"list",store:j.getCasesStore(),listeners:{itemtap:{fn:j.onCaseListItemTap,scope:this}}}]};j.setCasesList(a)}j.getImportListView().getComponent("container").push(j.getCasesList());j.setCurrentImportFile(d.getData().fullPath)}},onCaseListItemTap:function(c,d,j,b,h,f){var g=this;var a=function(e){console.log("Error: "+e)};g.getHelper().getFileData(g.getCurrentImportFile(),function(e){g.getSettingView().setMasked({xtype:"loadmask",message:"Importing..."});if(g.getFileUtils().isEncryptedData(e)){e=g.getFileUtils().XORDecode(e)}Formpod.importDevice(b.getData().form,e,function(){Ext.Msg.alert("Import Data","Data imported successfully",function(){},g);g.getSettingView().unmask()})});g.getImportListView().hide()},importData:function(){var a=this;var b={disclose:{fn:this.onImportListItemDisclosure,scope:a}};a.getHelper().loadImportedData(function(c){if(a.getImportStore()==undefined){var e=Ext.create("Ext.data.Store",{model:"cfa.model.Import",data:c,grouper:{groupFn:function(f){return f.get("type")}}});a.setImportStore(e);a.getImportStore().load();a.setImportListView(Ext.create("cfa.view.setting.ImportDataView"));var d={xtype:"list",mode:"MULTI",title:"Import List",itemId:"importlist",itemTpl:"{name}",onItemDisclosure:true,grouped:true};a.getImportListView().getComponent("container").add(d);a.getImportListView().getComponent("container").getComponent("importlist").setListeners(b);a.getImportListView().getComponent("container").getComponent("importlist").setStore(a.getImportStore());Ext.Viewport.add(a.getImportListView())}else{a.getImportListView().getComponent("container").reset();a.getImportStore().setData(Ext.JSON.decode(c))}if(Ext.os.is.Desktop){a.getImportListView().getComponent("dragpanel").getComponent("dragfilefield").show()}else{a.getImportListView().getComponent("dragpanel").getComponent("dragfilefield").hide()}a.getImportListView().showBy(a.getImportDataButton());a.setCurrentListView("importlist");if(!a.getIsBindDropEvent()){a.processDataFromDesktop();a.setIsBindDropEvent(true)}},function(){Ext.Msg.alert("Import Data","This may be cause error....",Ext.emptyFn,this)})},confirmResetData:function(a){if(a=="yes"){Ext.Msg.confirm("Reset Data","This action can not be reverted, do you really want to reset data?",this.confirmResetData2,this)}},confirmResetData2:function(a){if(a=="yes"){var b=Ext.getStore("Cases");b.getNode().removeAll();b.sync();var c=Ext.create("cfa.store.LSImages");c.load(function(){c.removeAll();c.sync()});Ext.Msg.alert("Reset Data","Data has been reset successfully.",Ext.emptyFn,this)}},saveUserData:function(){var a=Ext.getStore("Users").load(),c=this.getSettingView().getComponent("settingformpanel").getComponent(0).getComponent("firstname").getValue(),b=this.getSettingView().getComponent("settingformpanel").getComponent(0).getComponent("lastname").getValue();a.removeAll(false);a.add({firstname:c,lastname:b});a.sync();Ext.Msg.alert("Save user data","Data has been saved successfully.",Ext.emptyFn,this)},manageDocument:function(){var a=this;a.getHelper().loadDownloadedDocuments(function(b){if(a.getDocumentStore()==undefined){var d=Ext.create("Ext.data.Store",{model:"cfa.model.Import",data:b,grouper:{groupFn:function(e){return e.get("type")}}});a.setDocumentStore(d);a.getDocumentStore().load();var c={xtype:"list",title:"Downloaded Documents",itemId:"documentlist",itemTpl:"{name}",grouped:true};a.setDocumentStoreView(Ext.create("cfa.view.setting.ImportDataView"));a.getDocumentStoreView().getComponent("container").add(c);a.getDocumentStoreView().getComponent("container").getComponent("documentlist").setStore(a.getDocumentStore());a.getDocumentStoreView().getComponent("actionbar").show();Ext.Viewport.add(a.getDocumentStoreView())}else{a.getDocumentStoreView().getComponent("container").reset();a.getDocumentStore().setData(Ext.JSON.decode(b))}a.getDocumentStoreView().showBy(a.getManageDocumentButton());a.setCurrentListView("documentlist")},function(){Ext.Msg.alert("Manage Document","This may be cause error....",Ext.emptyFn,this)})},deleteFile:function(){var c=this;var a;if(this.getCurrentListView()=="importlist"){a=this.getImportListView().getComponent("container").getComponent("importlist").getSelection();importStore=this.getImportStore();for(var b=0;b<a.length;b++){importStore.remove(a[b]);c.getHelper().deleteFile(a[b].getData().fullPath)}c.getImportListView().hide();Ext.Msg.alert("Detele File","File(s) deleted")}else{a=this.getDocumentStoreView().getComponent("container").getComponent("documentlist").getSelection();var e=Ext.getStore("ReferencesDownloaded");var d=this.getDocumentStore();e.load({callback:function(h,g,k){for(var j=0;j<a.length;j++){d.remove(a[j]);var f=e.findRecord("title",a[j].getData().name.replace(".pdf",""));e.remove(f);c.getHelper().deleteFile(a[j].getData().fullPath)}e.sync({callback:function(){c.getDocumentStoreView().hide();Ext.Msg.alert("Detele File","Document(s) deleted")}})},scope:this,})}},processDataFromDesktop:function(){var c=this;if(window.FileReader){var a=document.getElementById("dragfilefield");function b(d){if(d.preventDefault){d.preventDefault()}return false}c.addEventHandler(a,"dragover",b);c.addEventHandler(a,"dragenter",b);c.addEventHandler(a,"drop",function(l){l=l||window.event;if(l.preventDefault){l.preventDefault()}var k=l.dataTransfer;var j=k.files;var h=[],d=[];var f=c.getImportStore();for(var g=0;g<j.length;g++){if(!f.findRecord("name",j[g].name)){h.push(j[g])}}if(h.length>0){c.putFileInToList(h,d)}else{Ext.Msg.alert("File Import","The file(s) already exists.")}return false})}else{Ext.Msg.alert("Alert","Your browser does not support the HTML5 FileReader. Please use Chrome browser")}},addEventHandler:function(c,a,b){if(c.addEventListener){c.addEventListener(a,b,false)}else{if(c.attachEvent){c.attachEvent("on"+a,b)}else{c["on"+a]=b}}},putFileInToList:function(g,h){var f=this;var e=g;var b=h;var c="";if(e[0]!=null){var d=e[0].name;if(e[0].name.toUpperCase().indexOf("CASE")>-1){c="Case"}else{c="Device"}var a=new FileReader();a.onloadend=function(j){var m=j.target.result.replace("data:;base64,","").replace("data:base64,","").replace("data:application/json;base64,","");if(f.getFileUtils().isEncryptedData(m)){m=f.getFileUtils().XORDecode(m);if(f.getFileUtils().isEncryptedData(m)){Ext.Msg.alert("Import Files","There is error(s) in decoded file");return}}var l=0,k=e.length;f.getHelper().saveDropFile(d,m,function(o){var n={};n.name=d;n.fullPath=o;n.type=c;b.push(n);l++;if(l==k){f.getImportStore().add(b);f.getImportStore().sync()}else{f.putFileInToList(e.slice(1,e.length),b)}})};a.readAsText(e[0])}},});Ext.define("cfa.controller.feedback.FeedbackController",{extend:"Ext.app.Controller",requires:["cfa.view.feedback.FeedbackView"],config:{routes:{feedback:"showFeedbackPage"},refs:{main:"main",sendFeedbackButton:"#sendfeedbackbtn",feedbackTextArea:"#feedbacktext"},control:{sendFeedbackButton:{tap:"sendFeedback"}}},showFeedbackPage:function(){if(Ext.os.is.Desktop){Ext.Msg.alert("Feedback","Currently support only for iPad.")}else{window.plugins.emailComposer.showEmailComposer("CFA users' feedback",null,null,"c3appfeedback@gmail.com",null,null,null)}},});Ext.define("cfa.controller.about.AboutController",{extend:"Ext.app.Controller",requires:["cfa.view.about.AboutView"],config:{routes:{about:"showAboutPage"}},showAboutPage:function(){if(!this.aboutView){this.aboutView=Ext.create("cfa.view.about.AboutView");Ext.Viewport.add(this.aboutView)}this.aboutView.show()}});Ext.define("cfa.controller.help.HelpController",{extend:"Ext.app.Controller",requires:["cfa.view.help.HelpView","cfa.view.help.HTMLPanel"],config:{routes:{help:"showHelpPage","help/:path":"showHelpById"},refs:{main:"main"}},showHelpPage:function(){var a=Ext.create("cfa.view.help.HTMLPanel");a.setUrl("data/HelpPages/HomeHelp.html");Ext.Viewport.add(a);a.show()},showHelpById:function(b){var a=Ext.create("cfa.view.help.HTMLPanel");a.setUrl("data/HelpPages/"+b+".html");Ext.Viewport.add(a);a.show()}});Ext.define("cfa.controller.phone.Dashboard",{extend:"cfa.controller.Dashboard",config:{},init:function(){this.callParent()}});Ext.define("cfa.model.Case",{extend:"Ext.data.Model",requires:["cfa.proxy.FormEngine"],config:{fields:["id","form",{name:"text",type:"string"}],validations:[{type:"formdata",field:"form"}],proxy:{type:"formengine"}},validate:function(){var m=Ext.create("Ext.data.Errors"),f=this.getValidations().items,h=Ext.data.Validations,d,g,l,a,k,j;if(f){d=f.length;for(j=0;j<d;j++){g=f[j];l=g.field||g.name;k=g.type;if(k=="formdata"){var b=this.get(l).engineClass;var c=b.definition;var e=Formpod.generator.getFormData(b.getForm());for(var j=0;j<c.length;j++){if(c[j].type=="textfield"&&c[j].required){a=!!e[c[j].name]||e[c[j].name]===0;if(!a){m.add(Ext.create("Ext.data.Error",{field:c[j].name,message:c[j].label+" is required."}))}}else{if(c[j].type=="emailfield"&&(e[c[j].name]!=""||c[j].required)){a=Ext.data.validations.emailRe.test(e[c[j].name]);if(!a){m.add(Ext.create("Ext.data.Error",{field:c[j].name,message:"Please enter a valid email address for "+c[j].label+" field."}))}}}}}else{a=h[k](g,this.get(l));if(!a){m.add(Ext.create("Ext.data.Error",{field:l,message:g.message||h.getMessage(k)}))}}}}return m}});Ext.define("cfa.store.Cases",{extend:"Ext.data.TreeStore",requires:["cfa.model.Case","cfa.proxy.FormEngine","cfa.store.CFAStore"],config:{model:"cfa.model.Case",defaultRootId:"cases",proxy:{type:"formengine"}}});Ext.define("cfa.store.SearchCases",{extend:"Ext.data.Store",requires:["cfa.model.Case","cfa.proxy.FormEngine","cfa.store.CFACustomStore"],config:{model:"cfa.model.Case",queryType:null,queryParam:null,proxy:{type:"formengine"}},updateQueryType:function(a,b){this.getProxy().setQueryType(a)},updateQueryParam:function(b,a){this.getProxy().setQueryParam(b)}});Ext.define("cfa.view.Main",{extend:"Ext.navigation.View",xtype:"main",requires:["cfa.view.Dashboards"],config:{fullscreen:true,navigationBar:{items:[{xtype:"button",text:"Home",iconCls:"home",iconMask:true,ui:"action",id:"home-btn",align:"right"},{xtype:"button",text:"Help",iconCls:"bookmarks",iconMask:true,ui:"action",id:"basic-btn",align:"right"},{xtype:"button",text:"Feedback",iconCls:"compose",iconMask:true,ui:"action",id:"fed-btn",align:"right"},{xtype:"button",text:"About",iconCls:"info",iconMask:true,ui:"action",id:"about-btn",align:"right"}]},items:[{xtype:"dashboards",store:"Dashboards",}],},pop:function(){this.callParent(arguments);cfa.app.helpUrl="root"},beforePop:function(a){this.fireEvent("beforepopcommand",this)},backToDashboard:function(){this.fireEvent("todashboardcommand",this)}});Ext.define("cfa.view.tablet.Main",{extend:"cfa.view.Main"});Ext.define("cfa.view.phone.Main",{extend:"cfa.view.Main",requires:[]});Ext.define("cfa.view.case.CaseFormSelectionView",{extend:"Ext.Panel",xtype:"caseformselection",requires:["cfa.store.CaseForms"],config:{layout:"fit",modal:true,centered:true,hideOnMaskTap:true,width:300,height:400,items:[{xtype:"list",id:"caseformlist",itemTpl:"{name}",store:"CaseForms"}]}});Ext.define("cfa.store.LSImages",{extend:"Ext.data.Store",requires:["cfa.model.Image"],storeId:"LSImages",config:{model:"cfa.model.Image",proxy:{type:Ext.os.is.Desktop?"chromefile":"file"}}});Ext.define("cfa.controller.case.CaseController",{extend:"Ext.app.Controller",requires:["cfa.view.case.CaseView","cfa.view.case.CaseFormSelectionView","cfa.store.LSImages"],config:{imageStore:undefined,imageList:undefined,currentImageURI:undefined,routes:{cases:"showCasePage"},refs:{main:"main",casesList:'nestedlist[id = "caseslist"]',caseContextPanel:'panel[id = "casecontextpanel"]',caseContentPanel:'panel[id = "casecontentpanel"]',caseFormPanel:'panel[id = "caseformpanel"]',caseToolbar:'toolbar[id = "casetoolbar"]',caseContextLabel:"#casecontextlabel",refreshCaseDataButton:"button[action = refreshCaseData]",addCaseDataButton:"button[action = addCaseData]",saveCaseDataButton:"button[action = savecasedata]",cancelCaseDataButton:"button[action = cancelcasedata]",caseFormList:'list[id = "caseformlist"]',exportCaseDataButton:"button[action = exportcasedata]",deleteCaseDataButton:"button[action = deletecasedata]",attachCaseDataButton:"button[action = attachcasedata]",deleteAttachmentButton:"button[action = deleteattachmentdata]",clearAllAttachmentButton:"button[action = clearattachmentdata]"},control:{main:{pop:"onPop",beforepopcommand:"onMainBack",todashboardcommand:"onBackToDashboard"},casesList:{itemtap:"caseItemTap",back:"casesListBackTap"},refreshCaseDataButton:{tap:"refreshCaseData"},addCaseDataButton:{tap:"addCaseData"},saveCaseDataButton:{tap:"saveCaseData"},cancelCaseDataButton:{tap:"cancelCaseData"},caseFormList:{itemtap:"caseFormSelected"},exportCaseDataButton:{tap:"exportCaseData"},deleteCaseDataButton:{tap:"deleteCaseData"},attachCaseDataButton:{tap:"attachCaseData"},deleteAttachmentButton:{tap:"deleteAttachmentData"},clearAllAttachmentButton:{tap:"clearAttachmentData"}},currentRecord:null,nextRecord:null,recordsPath:[],formSelectionView:null,imageStoreChanged:false,caseView:null,currentActionSheet:null,neededPop:false,neededRefesh:false,resetMainStack:false,helper:cfa.utils.HelperUtil.getHelper(),fileUtils:cfa.utils.FileUtils,isDesktop:Ext.os.is.Desktop},initForms:function(){if(!this.getFormSelectionView()){this.setFormSelectionView(Ext.create("cfa.view.case.CaseFormSelectionView"))}for(var a in Formpod.FormTypes){Formpod.FormTypes[a].deleteForm()}this.setRecordsPath([]);this.setCurrentRecord(null);this.setNextRecord(null)},showCasePage:function(){this.initForms();this.setCaseView(Ext.create("cfa.view.case.CaseView"));this.getMain().push(this.getCaseView());var a=Ext.getStore("Cases");a.load({callback:function(c,b,d){a.removed=[];if(a.getData().all.length==0){this.getCaseContextLabel().setHtml('<div align="center">"Tap on the + button to add a new case"</div>')}},scope:this});window.webkitStorageInfo.requestQuota(window.PERSISTENT,1024*1024*50,function(b){},function(b){Ext.Msg.alert("Error","Error allocating quota")})},onPop:function(a,b,d){if(b.getId()=="caseview"){var c=Ext.getCmp("imagelist");if(c){this.setImageStoreChanged(false);this.getCaseFormPanel().removeAll(true)}else{this.getCaseFormPanel().removeAll(false)}}if(this.getCurrentActionSheet()){this.getCurrentActionSheet().hide()}b.destroy()},onMainBack:function(){if(!this.getResetMainStack()){if(this.getImageStoreChanged()||this.formChanged()){this.setNextRecord(null);Ext.Msg.confirm("Data Changed","Do you want to save change information?",this.confirmFormChanged,this);this.setNeededPop(true)}else{this.getMain().doPop()}}else{this.getMain().doPop()}},onBackToDashboard:function(){if(this.getImageStoreChanged()||this.formChanged()){this.setNextRecord(null);Ext.Msg.confirm("Data Changed","Do you want to save change information?",this.confirmFormChanged,this);this.setResetMainStack(true)}else{this.getMain().reset()}},caseItemTap:function(g,f,b,j,a,h,c){if(this.formChanged()){this.setNextRecord(a);Ext.Msg.confirm("Data Changed","Do you want to save changes before openning new data?",this.confirmFormChanged,this);return}else{this.setNextRecord(a);this.confirmFormChanged("no")}if(!a.isLeaf()){var d=this.getRecordsPath();Ext.Array.insert(d,d.length,[a])}},refreshCaseData:function(){if(this.getImageStoreChanged()||this.formChanged()){this.setNextRecord(null);Ext.Msg.confirm("Data Changed","Do you want to save change information?",this.confirmFormChanged,this);this.setNeededRefesh(true)}else{this.doRefreshData()}},doRefreshData:function(){var a=Ext.getStore("Cases"),c=this.getRecordsPath(),b=c.length?c[c.length-1]:a.getNode();a.load({node:b,scope:this,callback:function(e,d,f){a.removed=[]}});this.setCurrentRecord(null);this.showCurrentRecord()},addCaseData:function(){if(this.formChanged()){this.setNextRecord(this.getNewRecord());Ext.Msg.confirm("Data Changed","Do you want to save changes before adding new data?",this.confirmFormChanged,this)}else{this.setNextRecord(this.getNewRecord());this.confirmFormChanged("no")}},getNewRecord:function(){var c=this.getRecordsPath();var a=Ext.create("cfa.model.Case");if(c.length){a.set("form",{engineClass:null})}else{var b=Formpod.FormTypes["Case Form"];a.set("form",b.getInstance())}return a},saveCaseData:function(){if(this.formChanged()){var g=this;var b=this.getCurrentRecord();if(b){var j=b.validate();if(!j.isValid()){var d="";Ext.each(j.items,function(m,l){d+=m.getMessage()+"<br>"});Ext.Msg.alert("Save Data",d,Ext.emptyFn);return false}var k=Ext.getStore("Cases"),f=b.phantom;if(f){k.add(b)}var c=b.get("form"),h=c.engineClass;c=h.getFormObject();b.beginEdit();b.set("form",c);b.set("text",c[Formpod.FormTypes[h.name].displayProperty]);b.endEdit();if(!f){b.setDirty(true)}if(f){var e=b.get("parentId");if(e){k.getNodeById(e).appendChild(b)}else{k.getNode().appendChild(b)}}this.getCaseView().setMasked({xtype:"loadmask",message:"Saving..."});var a=k.sync({callback:function(){g.showCurrentRecord();g.getCaseView().unmask();Ext.Msg.alert("Save Data","Data saved successfully");if(g.getNeededPop()){g.getMain().doPop();g.setNeededPop(false)}if(g.getNeededRefesh()){g.doRefreshData();g.setNeededRefesh(false)}if(g.getResetMainStack()){g.getMain().doPop();g.setResetMainStack(false)}}});if(this.getImageStore()!=undefined){this.getImageStore().sync();this.setImageStoreChanged(false)}h.scrollFormToTop()}return true}},cancelCaseData:function(){this.setCurrentRecord(null);this.showCurrentRecord()},exportCaseData:function(){var c=this,a=this.getCurrentRecord();if(a.phantom){Ext.Msg.alert("Export Data","You can not export unsaved data.");return}if(!c.getIsDesktop()){var b=Ext.create("Ext.ActionSheet",{modal:false,left:"40%",right:"40%",bottom:"6%",items:[{text:"Via email",handler:function(){Ext.Msg.alert("Export Data","Images are not included in export via email. To include images, export to iTunes.",function(){Formpod.exportData(a.getData().form,false,function(f){var d=a.getData().form.engineClass.name.replace(" ","").replace("/","")+"-"+Ext.util.Format.date(new Date(),"Ymd")+"-"+a.getData().form.id+".cfadata";var e=c.getFileUtils().XOREncode(f);c.getHelper().saveFile(e,d,function(g){if(c.getHelper().fileSizeValidation(d)){window.plugins.emailComposer.showEmailComposer("CFA Data",null,d,null,null,null,null)}else{Ext.Msg.alert("Export Data","The data is exported but it is larger than 10MB and reach the maximum total size of an attachment data in an email(10MB).<br>Please use iTunes to get the exported file.")}})})});b.hide()}},{text:"To iTunes",handler:function(){Formpod.exportData(a.getData().form,true,function(e){var d=a.getData().form.engineClass.name.replace(" ","").replace("/","")+"-"+Ext.util.Format.date(new Date(),"Ymd")+"-"+a.getData().form.id+".cfadata";c.getHelper().saveFile(e,d,function(){Ext.Msg.alert("Export Data","Data has been exported successfully.")});b.hide()})}},{text:"Cancel",ui:"confirm",handler:function(){b.hide()}}]});Ext.Viewport.add(b);b.show();this.setCurrentActionSheet(b)}else{Formpod.exportData(a.getData().form,true,function(f){var d=a.getData().form.engineClass.name.replace(" ","").replace("/","")+"-"+Ext.util.Format.date(new Date(),"Ymd")+"-"+a.getData().form.id+".cfadata";var e=c.getFileUtils().XOREncode(f);c.getHelper().saveFile(e,d,function(g){var h=document.createElement("a");h.href=g;h.download=d;document.body.appendChild(h);h.click();document.body.removeChild(h);c.getHelper().deleteFile("/"+d)})})}},deleteCaseData:function(){var a=this.getCurrentRecord();if(!a.phantom){Ext.Msg.confirm("Delete Data","Do you want to delete this data?",this.confirmDeleteData,this)}else{Ext.Msg.alert("Delete Data","You can not delete unsaved data.")}},attachCaseData:function(){var d=this;var a=function(j){var e=d.getCurrentRecord(),h=d.getImageStore();var g=e.get("form").PhotoId;h.add({formId:g,srcImage:"data:image/png;base64,"+j});var f=d.getImageStore().getData().length-1;d.getImageList().getScrollable().getScroller().scrollTo(330*f,0);d.setImageStoreChanged(true)};var c=function(e){console.log("Photo data error: ",e)};var b=Ext.create("Ext.ActionSheet",{modal:false,left:"40%",right:"40%",bottom:"6%",items:[{text:"From Camera",handler:function(){navigator.camera.getPicture(a,c,{quality:50,destinationType:navigator.camera.DestinationType.DATA_URL,encodingType:navigator.camera.EncodingType.PNG,sourceType:Camera.PictureSourceType.CAMERA,correctOrientation:true});b.hide()}},{text:"From Photo Library",handler:function(){navigator.camera.getPicture(a,c,{quality:50,sourceType:navigator.camera.PictureSourceType.PHOTOLIBRARY,destinationType:navigator.camera.DestinationType.DATA_URL,encodingType:navigator.camera.EncodingType.PNG});b.hide()}},{text:"Cancel",ui:"confirm",handler:function(){b.hide()}}]});Ext.Viewport.add(b);b.show();this.setCurrentActionSheet(b)},confirmDeleteData:function(c){if(c=="yes"){var b=Ext.getStore("Cases"),a=this.getCurrentRecord();this.getCasesList().goToNode(a.parentNode);if(!a.isLeaf()){this.casesListBackTap()}else{this.setCurrentRecord(null);this.showCurrentRecord()}a.parentNode.removeChild(a);b.remove(a);b.sync();var d=this.getImageStore();if(d){d.removeAll();d.sync();this.setImageStore(null)}}},casesListBackTap:function(f,e,d,a,b){if(this.formChanged()){this.setNextRecord(null);Ext.Msg.confirm("Data Changed","Do you want to save change information?",this.confirmFormChanged,this);return false}else{var c=this.getRecordsPath();Ext.Array.remove(c,c[c.length-1]);this.setCurrentRecord(null);this.showCurrentRecord()}if(this.getCurrentActionSheet()){this.getCurrentActionSheet().hide()}},caseFormSelected:function(k,g,h,d,j,l){this.getFormSelectionView().hide();var f=d.get("name"),c=Ext.create("cfa.model.Case"),m=Formpod.FormTypes[f];m.resetForm();c.set("form",m.getFormObject());if(m.childForms&&m.childForms.length){c.set("leaf",false)}else{c.set("leaf",true)}var b=this.getRecordsPath();if(b.length){var a=b[b.length-1];c.set("parentId",a.get("id"))}this.setCurrentRecord(c);this.showCurrentRecord()},showCurrentRecord:function(){var a=this.getCurrentRecord();if(a){var e=a.get("form");var d=e;var b=e.engineClass;b.resetForm();b.loadForm(d);var c=b.getForm();this.getCaseFormPanel().removeAll(false);this.getCaseFormPanel().add(c);if(b.attachment=="photo"){this.addImageListById(d.PhotoId)}else{this.addImageListById(null)}this.getCaseContentPanel().show()}else{this.getCaseFormPanel().removeAll(false);this.getCaseContentPanel().hide()}this.showEditToolbar(a);this.showContextInfo(a)},addImageListById:function(c){this.setImageStore(undefined);this.setImageList(undefined);if(c!=undefined){var b=Ext.create("cfa.store.LSImages");b.filterBy(function(d){return d.getData().formId==c});b.getProxy().setFormId(c);b.load();this.setImageStore(b);var a=Ext.create("Ext.List",{id:"imagelist",itemTpl:new Ext.XTemplate('<img src="{srcImage}"  style = "max-width:320px; max-height:240px;"/>'),inline:{wrap:false},scrollable:{direction:"horizontal"},flex:2,store:this.getImageStore()});this.setImageList(a);this.getCaseFormPanel().add(this.getImageList());if(this.getIsDesktop()){this.processImageDesktop()}}},showEditToolbar:function(a){var c=this.getCaseToolbar();if(a){var b=a.get("form").engineClass;if(b.attachment=="photo"){if(!this.getIsDesktop()){this.getAttachCaseDataButton().show()}else{this.getAttachCaseDataButton().hide()}this.getDeleteAttachmentButton().show();this.getClearAllAttachmentButton().show()}else{this.getAttachCaseDataButton().hide();this.getDeleteAttachmentButton().hide();this.getClearAllAttachmentButton().hide()}c.show()}else{c.hide()}},showContextInfo:function(a){if(a){var c,b=a.get("form").engineClass;if(a.phantom){c=Ext.String.format('<div align="center">New {0}<br />{1}</div>',b.name,b.description)}else{c=Ext.String.format('<div align="center">{0}<br />{1}</div>',b.name,b.description)}this.getCaseContextLabel().setHtml(c)}else{this.getCaseContextLabel().setHtml("")}},formChanged:function(){var a=this.getCurrentRecord();var e=false;if(a){var c=a.getData().form;var b=c.engineClass,d=b.getFormObject();for(key in d){if(d[key]==""&&c[key]==null){continue}if(d[key]==null&&c[key]==""){continue}if(typeof d[key]=="object"){if(d[key] instanceof Date){if(typeof c[key]!="undefined"&&c[key]!=null){if(Ext.Date.format(d[key],Formpod.dateFormat)!=Ext.Date.format(c[key],Formpod.dateFormat)){e=true}}else{e=true}}}else{if(typeof d[key]=="string"){if(d[key]!=c[key]){e=true;break}}}}}if(this.getImageStoreChanged()){e=true}return e},confirmFormChanged:function(b){if(b=="yes"){if(!this.saveCaseData()){return}}else{if(this.getNeededPop()){this.getMain().doPop();this.setNeededPop(false)}if(this.getNeededRefesh()){this.doRefreshData();this.setNeededRefesh(false)}if(this.getResetMainStack()){this.getMain().reset();this.setResetMainStack(false)}if(this.getImageStoreChanged()){this.setImageStoreChanged(false)}}var e=this.getNextRecord();if(!e){}else{if(e.phantom){var c=e.get("form").engineClass;if(c){c.resetForm();e.set("form",c.getFormObject())}else{var d=this.getRecordsPath();var a=Ext.getStore("CaseForms"),f=d[d.length-1],g=f.get("form").engineClass.childForms;a.clearFilter();a.filterBy(function(h){return Ext.Array.contains(g,h.get("name"))});this.getFormSelectionView().showBy(this.getCasesList().getToolbar());return}}else{}}this.setCurrentRecord(e);this.showCurrentRecord()},deleteAttachmentData:function(){var d=this.getImageStore(),c=this.getImageList(),a=c.getSelection();for(var b=0;b<a.length;b++){d.remove(a[b])}this.setImageStoreChanged(true)},clearAttachmentData:function(){var a=this.getImageStore();a.removeAll();this.setImageStoreChanged(true)},processImageDesktop:function(){var d=this;var a=d.getCurrentRecord();var f=d.getImageStore();var e=a.get("form").PhotoId;if(window.FileReader){var b=document.getElementById("imagelist");function c(g){if(g.preventDefault){g.preventDefault()}return false}d.addEventHandler(b,"dragover",c);d.addEventHandler(b,"dragenter",c);d.addEventHandler(b,"drop",function(m){m=m||window.event;if(m.preventDefault){m.preventDefault()}var l=m.dataTransfer;var k=l.files;for(var j=0;j<k.length;j++){var h=k[j];var g=new FileReader();g.onloadend=function(n){f.add({formId:e,srcImage:n.target.result})};g.readAsDataURL(h)}return false})}else{Ext.Msg.alert("Alert","Your browser does not support the HTML5 FileReader. Please use Chrome browser")}},addEventHandler:function(c,a,b){if(c.addEventListener){c.addEventListener(a,b,false)}else{if(c.attachEvent){c.attachEvent("on"+a,b)}else{c["on"+a]=b}}}});Ext.define("Deft.ioc.Injector",{alternateClassName:["Deft.Injector"],requires:["Deft.log.Logger","Deft.ioc.DependencyProvider"],singleton:true,constructor:function(){this.providers={};return this},configure:function(a){Deft.Logger.log("Configuring injector.");Ext.Object.each(a,function(c,b){var d;Deft.Logger.log("Configuring dependency provider for '"+c+"'.");if(Ext.isString(b)){d=Ext.create("Deft.ioc.DependencyProvider",{identifier:c,className:b})}else{d=Ext.create("Deft.ioc.DependencyProvider",Ext.apply({identifier:c},b))}this.providers[c]=d},this);Ext.Object.each(this.providers,function(b,c){if(c.getEager()){Deft.Logger.log("Eagerly creating '"+(c.getIdentifier())+"'.");c.resolve()}},this)},canResolve:function(a){var b;b=this.providers[a];return b!=null},resolve:function(a,b){var c;c=this.providers[a];if(c!=null){return c.resolve(b)}else{Ext.Error.raise({msg:"Error while resolving value to inject: no dependency provider found for '"+a+"'."})}},inject:function(a,c,f){var e,b,h,g,d;if(f==null){f=true}e={};if(Ext.isString(a)){a=[a]}Ext.Object.each(a,function(m,n){var l,j,k;k=Ext.isArray(a)?n:m;l=n;j=this.resolve(l,c);if(k in c.config){Deft.Logger.log("Injecting '"+l+"' into '"+k+"' config.");e[k]=j}else{Deft.Logger.log("Injecting '"+l+"' into '"+k+"' property.");c[k]=j}},this);if(f){for(b in e){d=e[b];g="set"+Ext.String.capitalize(b);c[g].call(c,d)}}else{if(Ext.isFunction(c.initConfig)){h=c.initConfig;c.initConfig=function(k){var j;j=h.call(this,Ext.Object.merge({},k||{},e));return j}}}return c}});Ext.define("Deft.mixin.Injectable",{requires:["Deft.ioc.Injector"],onClassMixedIn:function(a){a.prototype.constructor=Ext.Function.createInterceptor(a.prototype.constructor,function(){return Deft.Injector.inject(this.inject,this,false)})}});Ext.define("cfa.view.contact.ContactView",{extend:"Ext.Container",mixins:["Deft.mixin.Injectable"],inject:["contactStore"],alias:"widget.contact_view_container",requires:["cfa.view.contact.ContactsList","cfa.model.Contact","cfa.view.contact.ContactDetail","cfa.reader.Csv"],config:{title:"Contacts",layout:"hbox",contactStore:null},initialize:function(){this.callParent(arguments);cfa.app.helpUrl="ContactHelp";var h={xtype:"toolbar",title:"Contacts",docked:"top",layout:{pack:"right",align:"center"},items:[{xtype:"button",iconMask:true,iconCls:"refresh",handler:this.reloadContactClick,scope:this},],};var b={xtype:"searchfield",id:"searchcontacinput",clearIcon:false};var d={xtype:"selectfield",label:"By:",id:"contact-option",style:"width: 120px; font-size: 0.9em",options:[{text:"Name",value:"name"},{text:"SAC",value:"sac"},{text:"RAC",value:"rac"}]};var g={xtype:"toolbar",docked:"top",id:"search-bar",items:[b,d]};var c={xtype:"contact_list",itemId:"contactlist",store:this.getContactStore().load(),listeners:{select:{fn:this.onItemSelected,scope:this}}};var e={xtype:"toolbar",docked:"bottom",layout:{align:"center",pack:"right"},items:[{xtype:"button",text:"Name",handler:this.onNameGroupClick,scope:this,},{xtype:"spacer",},{xtype:"button",text:"SAC",handler:this.onSacGroupClick,scope:this,},{xtype:"button",text:"RAC",handler:this.onRacGroupClick,scope:this},]};var a={xtype:"panel",itemId:"contactleftpanel",layout:"fit",flex:1,items:[h,g,c,e]};var f={xtype:"contact_detail",flex:2};this.add([a,f])},onItemSelected:function(c,a,b){this.fireEvent("contactDetailCommand",this,a)},reloadContactClick:function(){this.fireEvent("reloadContactCommand",this)},onNameGroupClick:function(){this.fireEvent("nameGroupClick",this)},onSacGroupClick:function(){this.fireEvent("sacGroupClick",this)},onRacGroupClick:function(){this.fireEvent("racGroupClick",this)}});Ext.define("cfa.controller.contact.ContactController",{extend:"Ext.app.Controller",requires:["cfa.view.contact.ContactView"],config:{routes:{contacts:"showContactPage"},refs:{main:"main",contactContainer:"contact_view_container",contactDetailView:"contact_detail",searchInputField:'searchfield[id = "searchcontacinput"]',emailField:"urlfield[id = email]",searchOptionField:'selectfield[id="contact-option"]'},control:{contactContainer:{contactDetailCommand:"displayContactDetail",reloadContactCommand:"reloadContact",nameGroupClick:"onNameGroupClick",sacGroupClick:"onSacGroupClick",racGroupClick:"onRacGroupClick",},searchInputField:{keyup:"searchContactByKey",},emailField:{openmailcomposercommand:"openEmailComposer"},searchOptionField:{change:"changeSearchOption"}},searchOption:"name",contactView:null},displayContactDetail:function(b,a){var c=this.getContactDetailView();c.setRecord(a)},reloadContact:function(a){a.getContactStore().load()},showContactPage:function(){this.setContactView(Ext.create("cfa.view.contact.ContactView"));this.getMain().push(this.getContactView())},changeSearchOption:function(d,e,b,c){var a=this.getContactView().getComponent("contactleftpanel").getComponent("contactlist").getStore();a.clearFilter();this.getSearchInputField().setValue("");this.setSearchOption(e)},searchContactByKey:function(a,g,f){var d=this;var c=this.getContactView().getComponent("contactleftpanel").getComponent("contactlist").getStore();c.clearFilter();if(a.getValue()&&a.getValue()!=""){var b=a.getValue().toLowerCase();c.filterBy(function(h){if(d.getSearchOption()=="name"){var e=h.getData().firstname+" "+h.getData().lastname;if(h.getData().firstname.toLowerCase().indexOf(b)>-1||h.getData().lastname.toLowerCase().indexOf(b)>-1){return h}else{if(e.toLowerCase().indexOf(b)>-1){return h}}}else{if(d.getSearchOption()=="sac"){if(h.getData().SAC.toLowerCase().indexOf(b)>-1){return h}}else{if(h.getData().RAC.toLowerCase().indexOf(b)>-1){return h}}}})}},openEmailComposer:function(){var a=this.getContactDetailView().getComponent(0).getComponent("email").getValue();if(a){window.plugins.emailComposer.showEmailComposer(null,null,null,a,null,null,null)}else{Ext.Msg.alert("Send mail","Please chose a contact that you want to send mail to.")}},onNameGroupClick:function(c){var b=c.getContactStore().load();b.clearFilter();var a={groupFn:function(d){return d.get("lastname")[0]},sortProperty:"lastname",direction:"ASC"};b.setGrouper(a);Ext.getStore("Contacts").load()},onSacGroupClick:function(c){var b=c.getContactStore().load();b.clearFilter();var a={groupFn:function(d){return d.get("SAC")},sortProperty:"SAC",direction:"ASC"};b.setGrouper(a);Ext.getStore("Contacts").load()},onRacGroupClick:function(c){var b=c.getContactStore().load();b.clearFilter();var a={groupFn:function(d){return d.get("RAC")},sortProperty:"RAC",direction:"ASC"};b.setGrouper(a);Ext.getStore("Contacts").load()}});Ext.define("cfa.view.event.EventView",{extend:"Ext.Container",mixins:["Deft.mixin.Injectable"],inject:["eventStore"],alias:"widget.event_view_container",requires:["cfa.view.event.EventsList","cfa.model.Event","cfa.view.event.EventDetail","cfa.reader.Csv"],config:{title:"Events",layout:"hbox",eventStore:null},initialize:function(){this.callParent(arguments);cfa.app.helpUrl="EventHelp";var e={xtype:"toolbar",title:"Events",docked:"top"};var a={xtype:"toolbar",items:[{xtype:"button",align:"left",iconMask:true,iconCls:"refresh",handler:this.onRefreshClick,scope:this},{xtype:"spacer"},{xtype:"button",text:"Date",align:"right",handler:this.monthGroupClick,scope:this},{xtype:"button",text:"Location",align:"right",handler:this.officeGroupClick,scope:this}],docked:"bottom"};var d={xtype:"events_list",store:this.getEventStore().load(),listeners:{select:{fn:this.onItemSelected,scope:this}}};var c={xtype:"panel",layout:"fit",flex:1,items:[e,d,a]};var b={xtype:"event_detail",flex:2};this.add([c,b])},onItemSelected:function(c,a,b){this.fireEvent("displayEventDetailCommand",this,a)},onRefreshClick:function(){this.fireEvent("reloadDataCommand",this)},monthGroupClick:function(){this.fireEvent("groupByMonthCommand",this)},officeGroupClick:function(){this.fireEvent("groupByOfficeCommand",this)}});Ext.define("cfa.controller.event.EventController",{extend:"Ext.app.Controller",requires:["cfa.view.event.EventView"],config:{routes:{events:"showEventPage"},refs:{main:"main",eventsContainer:"event_view_container",eventDetailViewer:"event_detail"},control:{eventsContainer:{displayEventDetailCommand:"displayEventDetail",reloadDataCommand:"reloadData",groupByOfficeCommand:"groupByOffice",groupByMonthCommand:"groupByMonth"}}},showEventPage:function(){var a=Ext.create("cfa.view.event.EventView");this.getMain().push(a)},displayEventDetail:function(b,a){var c=this.getEventDetailViewer();c.setRecord(a)},reloadData:function(a){a.getEventStore().load()},groupByMonth:function(c){var b=c.getEventStore().load();var a={groupFn:function(d){return Ext.util.Format.date(d.get("start_date"),"m/d/Y")},sortProperty:"date",direction:"ASC"};b.setGrouper(a);Ext.getStore("Events").load()},groupByOffice:function(c){var b=c.getEventStore().load();var a={groupFn:function(d){return d.get("location")},sortProperty:"location",direction:"ASC"};b.setGrouper(a);Ext.getStore("Events").load()}});Ext.define("cfa.view.reference.ReferenceView",{extend:"Ext.Panel",mixins:["Deft.mixin.Injectable"],inject:["referenceStore"],alias:"widget.reference_view_container",requires:["cfa.view.reference.ReferencesList","cfa.model.Reference","cfa.reader.Csv"],config:{layout:"fit",title:"References",referenceStore:null},initialize:function(){this.callParent(arguments);cfa.app.helpUrl="ReferenceHelp";var a={xtype:"references_list",itemId:"referenceslist",listeners:{itemtap:{fn:this.onItemSelected,scope:this}}};var b={xtype:"panel",itemId:"contentpanel",layout:"fit",flex:1,items:[{xtype:"searchfield",id:"referencesearchfield",docked:"top",clearIcon:false},a]};this.add(b)},onItemSelected:function(b,c,g,a,f,d){this.fireEvent("openReferenceSourceCommand",this,g,a)},});Ext.define("cfa.controller.reference.ReferenceController",{extend:"Ext.app.Controller",requires:["cfa.view.reference.ReferenceView"],config:{routes:{reference:"showReferencePage"},refs:{main:"main",referenceViewContainer:"reference_view_container",referenceDetail:"reference_detail",referenceSearhField:'searchfield[id = "referencesearchfield"]'},control:{referenceViewContainer:{openReferenceSourceCommand:"openReferenceResource"},referenceSearhField:{keyup:"searchReferencesByKey"},main:{beforepopcommand:"onMainBack",}},referenceView:null,currentRecord:null,currentActionSheet:null,downloadedDocumentStore:null,isOnline:cfa.helper.PhoneGapHelper.isOnLine(),isDesktop:Ext.os.is.Desktop},onError:function(a){console.log(a)},onMainBack:function(){if(this.getCurrentActionSheet()){this.getCurrentActionSheet().hide()}},openReferenceResource:function(b,e,a){this.setCurrentRecord(a);if(this.getCurrentActionSheet()){this.getCurrentActionSheet().hide()}if(a.getData().url.toLowerCase().indexOf(".pdf")>-1){if(!this.getIsOnline()){if(!this.getIsDesktop()){var d=this;window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(f){f.root.getFile(a.getData().title,{create:true},function(h){var g=h.toURI();window.plugins.childBrowser.showWebPage(g+".pdf")},d.onError)},d.onError)}else{Ext.Msg.alert("References ","You are in offline mode. Please open the document on you PC if you downloaded it.")}}else{var d=this;var c=Ext.create("Ext.Panel",{modal:false,layout:"fit",height:"50px",width:"235px",items:[{xtype:"toolbar",items:[{xtype:"button",text:"View",ui:"confirm",handler:function(){d.openReferenceInWebview()}},{xtype:"button",text:"Download",handler:function(){d.saveReferenceToLocal()}},{xtype:"button",text:"Cancel",handler:function(){c.hide()}}]}]});Ext.Viewport.add(c);this.setCurrentActionSheet(c);c.showBy(e)}}else{this.openReferenceInWebview()}},openReferenceInWebview:function(){currentRecord=this.getCurrentRecord();if(Ext.os.is.Desktop){window.open(currentRecord.getData().url)}else{window.plugins.childBrowser.showWebPage(currentRecord.getData().url)}this.getCurrentActionSheet().hide()},saveReferenceToLocal:function(){var a=this.getCurrentRecord();if(this.isDownloaded(a)){this.getCurrentActionSheet().hide();Ext.Msg.confirm("Download Reference","This document is already downloaded.<br> Do you want to re-download it?",this.cofirmDownload,this)}else{this.doDownload()}},cofirmDownload:function(a){if(a=="yes"){this.getDownloadedDocumentStore().remove(this.getCurrentRecord());this.doDownload()}},doDownload:function(d){var e=this;var f=Ext.getStore("ReferencesDownloaded"),a=this.getCurrentRecord();var c=a.getData().title,b=a.getData().url;e.getCurrentActionSheet().hide();if(!this.getIsDesktop()){e.getReferenceView().setMasked({xtype:"loadmask",message:"Downloading..."});cfa.helper.PhoneGapHelper.downloadFile(c,b,function(){e.getDownloadedDocumentStore().add(a.copy());e.getDownloadedDocumentStore().sync({callback:function(){e.getReferenceView().unmask();a.beginEdit();a.set("downloaded","Downloaded");a.endEdit();Ext.Msg.alert("Download Reference","Document downloaded")}})})}else{var g=document.createElement("a");g.href=b;g.download=c;document.body.appendChild(g);g.click();document.body.removeChild(g)}},isDownloaded:function(a){if(a.getData().downloaded.toLowerCase()=="downloaded"){return true}else{return false}},showReferencePage:function(){var b=this;this.setReferenceView(Ext.create("cfa.view.reference.ReferenceView"));this.getMain().push(this.getReferenceView());this.setDownloadedDocumentStore(Ext.getStore("ReferencesDownloaded"));var a=this.getReferenceView().getReferenceStore();a.load({callback:function(d,c,f){var e=d;this.getDownloadedDocumentStore().load({callback:function(h,g,k){for(var j=0;j<e.length;j++){if(this.getDownloadedDocumentStore().findRecord("title",e[j].getData().title)){e[j].beginEdit();e[j].set("downloaded","Downloaded");e[j].endEdit()}else{e[j].beginEdit();e[j].set("downloaded","");e[j].endEdit()}}this.getReferenceView().getComponent("contentpanel").getComponent("referenceslist").setStore(a)},scope:b})},scope:b})},searchReferencesByKey:function(a,d,c){var b=this.getReferenceView().getComponent("contentpanel").getComponent("referenceslist").getStore();b.clearFilter();b.filterBy(function(e){if(e.getData().title.toLowerCase().indexOf(a.getValue().toLowerCase())>-1){return e}})}});Ext.Loader.setPath({cfa:"app",Deft:"app/lib/deft"});Ext.require(["Deft.*","cfa.helper.PhoneGapHelper","cfa.helper.ChromeHelper","cfa.utils.HelperUtil","cfa.utils.FileUtils"]);Ext.application({name:"cfa",helpUrl:"root",requires:["Ext.MessageBox","cfa.proxy.File","cfa.proxy.ChromeFile"],profiles:["Tablet","Phone"],stores:["Base","Dashboards","Events","Cases","Contacts","References","LSContacts","EventsLocal","ReferencesLocal","CaseForms","SearchCases","SearchTemplates","Users","ReferencesDownloaded"],icon:{"57":"resources/icons/Icon.png","72":"resources/icons/Icon~ipad.png","114":"resources/icons/Icon@2x.png","144":"resources/icons/Icon~ipad@2x.png"},isIconPrecomposed:true,startupImage:{"320x460":"resources/startup/320x460.jpg","640x920":"resources/startup/640x920.png","768x1004":"resources/startup/768x1004.png","748x1024":"resources/startup/748x1024.png","1536x2008":"resources/startup/1536x2008.png","1496x2048":"resources/startup/1496x2048.png"},buildVersion:null,launch:function(){this.buildVersion=new Ext.Version("1.2");Formpod.init(FD_Forms,Formpod.FormEngine.CodeGenerators.Sencha);Ext.getStore("CaseForms").setData(Formpod.Forms);Deft.Injector.configure({contactStore:{fn:function(){if(cfa.helper.PhoneGapHelper.isOnLine()){var a=Ext.create("cfa.store.Contacts");a.setOfflineStore(Ext.create("cfa.store.LSContacts"));return a}else{return Ext.create("cfa.store.LSContacts")}}},eventStore:{fn:function(){if(cfa.helper.PhoneGapHelper.isOnLine()){var a=Ext.create("cfa.store.Events");a.setOfflineStore(Ext.create("cfa.store.EventsLocal"));return a}else{return Ext.create("cfa.store.EventsLocal")}}},referenceStore:{fn:function(){if(cfa.helper.PhoneGapHelper.isOnLine()){var a=Ext.create("cfa.store.References");a.setOfflineStore(Ext.create("cfa.store.ReferencesLocal"));return a}else{return Ext.create("cfa.store.ReferencesLocal")}}}});Ext.fly("appLoadingIndicator").destroy()},onUpdated:function(){Ext.Msg.confirm("Application Update","This application has just successfully been updated to the latest version. Reload now?",function(a){if(a==="yes"){window.location.reload()}})}});